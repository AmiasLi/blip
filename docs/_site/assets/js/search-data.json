{"0": {
    "doc": "API",
    "title": "API",
    "content": " ",
    "url": "http://localhost:4000/v1.0/api/",
    "relUrl": "/v1.0/api/"
  },"1": {
    "doc": "AWS",
    "title": "AWS",
    "content": "Blip has built-in supprot for Amazon RDS for MySQL and Amazon Aurora. It supports fetching the MySQL password from AWS Secrets Manager and using IAM authentication tokens. IAM Authentication . CREATE USER 'blip' IDENTIFIED WITH AWSAuthenticationPlugin as 'RDS'; GRANT ALL PRIVILEGES ON `blip`.* TO 'blip'@'%' REQUIRE SSL; GRANT SELECT ON `performance_schema`.* TO 'blip'@'%' REQUIRE SSL; . ",
    "url": "http://localhost:4000/v1.0/cloud/aws",
    "relUrl": "/v1.0/cloud/aws"
  },"2": {
    "doc": "Blip",
    "title": "Blip",
    "content": " ",
    "url": "http://localhost:4000/v1.0/config/blip",
    "relUrl": "/v1.0/config/blip"
  },"3": {
    "doc": "Blip",
    "title": "Zero Config",
    "content": "Blip uses built-it defaults and auto-detection to run and work without specifing any configuration. This is called the “zero config”. The zero config should work on your laptop (presuming a standard MySQL setup), but it is not intended for real production environments. At the very least, you will need to specify which MySQL instances to monitor in the monitors section of the Blip config file. ",
    "url": "http://localhost:4000/v1.0/config/blip#zero-config",
    "relUrl": "/v1.0/config/blip#zero-config"
  },"4": {
    "doc": "Blip",
    "title": "Specifying a Config File",
    "content": "Blip configuration is specified in a single YAML file. There are 3 ways to specify the Blip config file. By default, Blip uses blip.yaml in the current working directory: . $ blip . You can specify a config file with the --config command-line option: . $ blip --config FILE . Or, you can specify a config file with the BLIP_CONFIG environment variable: . $ export BLIP_CONFIG=FILE $ blip . The command-line option takes precedent over the environment variable. In the following example, Blip uses only FILE_2: . $ export BLIP_CONFIG=FILE_1 $ blip --config FILE_2 . ",
    "url": "http://localhost:4000/v1.0/config/blip#specifying-a-config-file",
    "relUrl": "/v1.0/config/blip#specifying-a-config-file"
  },"5": {
    "doc": "Blip",
    "title": "Command Line Options",
    "content": "Run blip --help to list command line options. --config FILE . Default: blip.yaml Env var: BLIP_CONFIG . Specify Blip configuruation file. --debug . Env var: BLIP_CONFIG . Print debug to stderr. --help . Print help and exit. --plans FILE[,FILE...] . Env var: BLIP_PLANS . Specify plan files. --print-config . Print config. --print-domains . Print domains and collector options. --print-monitors . Print monitors. --print-plans . Print level plans. --run . Default: true Env var: BLIP_RUN . Run Blip and all monitors. If --run=false, Blip starts and loads everything, but exists before running monitors. --strict . Env var: BLIP_STRICT . Enable strict mode. --version . Print version and exit. ",
    "url": "http://localhost:4000/v1.0/config/blip#command-line-options",
    "relUrl": "/v1.0/config/blip#command-line-options"
  },"6": {
    "doc": "chronosophere",
    "title": "Chronosphere Sink",
    "content": "sinks: chronosphere: url: \"http://127.0.0.1:3030/openmetrics/write\" . Defaults should work presuming a local Chronocollector is running; else, set url option to address of Chronocollector. Reports all tags as Prometheus labels. Reports Prometheus-style metric names: mysql_status_threads_running instead of status.global.threads_running. ",
    "url": "http://localhost:4000/v1.0/sinks/chronosphere#chronosphere-sink",
    "relUrl": "/v1.0/sinks/chronosphere#chronosphere-sink"
  },"7": {
    "doc": "chronosophere",
    "title": "chronosophere",
    "content": " ",
    "url": "http://localhost:4000/v1.0/sinks/chronosphere",
    "relUrl": "/v1.0/sinks/chronosphere"
  },"8": {
    "doc": "Cloud",
    "title": "Cloud",
    "content": " ",
    "url": "http://localhost:4000/v1.0/cloud/",
    "relUrl": "/v1.0/cloud/"
  },"9": {
    "doc": "Collectors",
    "title": "Collectors",
    "content": "Metric collectors and domains are one-to-one: Blip uses one metric collector for each domain. The innodb collector, for example, collects metrics for the innodb domain. Collectors are not configured in the Blip config file. In most cases, you don’t need to do anything with respect to collectors because they’re designed to work automatically with default values. ",
    "url": "http://localhost:4000/v1.0/metrics/collectors",
    "relUrl": "/v1.0/metrics/collectors"
  },"10": {
    "doc": "Collectors",
    "title": "Options",
    "content": "Collectors have options that are set in a plan (see Plans &gt; File &gt; Options). $ blip --print-domains | less . Run the command above to print all domains and collector help for each, which includes the collector options. For example, the innodb domain collector help output looks like: . innodb InnoDB metrics (information_schema.innodb_metrics) Options: all: Collect all metrics | enabled = Enabled metrics (ignore metrics list) | no = Specified metrics (default) | yes = All metrics (ignore metrics list) . The collector has one option, all, with the valid values listed below. The default option (no) is noted by “(default)”. In rare case where documented, a collector has required options. ",
    "url": "http://localhost:4000/v1.0/metrics/collectors#options",
    "relUrl": "/v1.0/metrics/collectors#options"
  },"11": {
    "doc": "Collectors",
    "title": "List",
    "content": "Since collectors and domains are one-to-one, run the following command to list all collectors: . $ blip --print-domains | less . ",
    "url": "http://localhost:4000/v1.0/metrics/collectors#list",
    "relUrl": "/v1.0/metrics/collectors#list"
  },"12": {
    "doc": "Collectors",
    "title": "Enable/Disable",
    "content": "Collectors are only used when referenced in a plan. For example, if no plan references the size.index domain, then its collector is not used—it’s not even instantiated, so unused collectors do not consume memory. Therefore, you don’t need to enable or disable collectors. If a collector is not listed (see above), then it has not been registered. Blip automatically registers all built-in collectors, so a missing collector should only occur with custom collectors (see below). ",
    "url": "http://localhost:4000/v1.0/metrics/collectors#enabledisable",
    "relUrl": "/v1.0/metrics/collectors#enabledisable"
  },"13": {
    "doc": "Collectors",
    "title": "Custom",
    "content": "All collectors are plugins, even the Blip built-in collectors. 1. Develop . Implement blip.Collector and blip.CollectorFactory. 2. Register . metrics.Register(myFactory, \"mydomain\") . 3. Reference . level: collect: mydomain: . ",
    "url": "http://localhost:4000/v1.0/metrics/collectors#custom",
    "relUrl": "/v1.0/metrics/collectors#custom"
  },"14": {
    "doc": "Blip",
    "title": "Blip",
    "content": "In the simplest setup, a single Blip instance monitors (collect metrics from) a single MySQL instance: . But a single instnace of Blip—a single running blip binary—can monitor any number of MySQL instances: . In Blip lingo (and source code), a monitor collects metrics from a single instance of MySQL, as shown above. In short, “a monitor monitors MySQL.” . Monitors are the central concept in Blip, so let’s zoom in on one monitor to see what makes it ticks: . A monitor has more parts than shown above, but three parts are most important: . Sinks Sinks send metrics to some graphing system. A monitor can send metrics to more than one sink. Blip has built-in sinks for SignalFx and Chronosphere, and it’s easy to write your own sink, which means Blip can send metrics anywhere. Plan A plan determines which metrics to collect. Blip has a default plan that collects more than 60 of the most important MySQL metrics. Plans can be customized. Engine The engine is the core part of a monitor that collects metrics from MySQL (according to the plan). There are many more parts to a monitor, but sinks and plans are the two you are most likely to customize—more on this later. You can’t customize the engine, but you can customize the plan that determines which metrics the engine collects. Let’s zoom in on the engine: . Inside the engine, another part called a metrics collector (or collector for short) collects metrics for one domain: a logical group of MySQL metrics. Above, the engine has four collectors that correspond to four domains: . | Domain | Logical Group | . | status.global | SHOW GLOBAL STATUS | . | var.global | SHOW GLOBAL VARIABLES | . | repl | SHOW REPLICA STATUS, … | . | aws | CloudWatch Metrics | . First, you might notice that a collector is not required required to collect metrics from MySQL. An AWS collector, for example, collects related MySQL metrics from Amazon CloudWatch. But most collectors collect metrics from various outputs of MySQL. Second, why a new abstraction—why “domains”? Because MySQL metrics are unorganized, and some metrics can be obtained from multiple outpus. For example, you can obtain the global system variable max_connections from three different outputs (or commands): . | SHOW GLOBAL VARIABLES LIKE 'max_connections'; | SELECT @@GLOBAL.max_connections; | SELECT * FROM global_variables WHERE variable_name='max_connections'; | . That’s a trivial exmaple. Metric domains become important—practically necessary—when you account for the MySQL Performance Schema (and sometimes the MySQL sys Schema), various command and output changes from MySQL 5.6 to 5.7 to 8.0, subtle differences between distributions (Oracle vs. Percona vs. MariaDB), and cloud providers (like Amazon RDS). Metric domains simplify how metrics are collected. As a user, you shouldn’t care how metrics are collected; you should only care which metrics are collected. Domains and plans make that possible… . A level plan (or plan for short) configures which metrics to collect—by domain. Here’s a snippet of a plan that collects two metrics every 5 seconds: . key-perf-indicators: freq: 5s collect: status.global: metrics: - Queries - Threads_running . First of all, don’t worry: Blip has a built-in plan that collects every common and important MySQL metric, including meta-metrics like database and table sizes. You never have to specify a plan, but chances are that you’ll eventually write your own custom plans, espcially when you learn what other Blip features plans make possible. In the plan snippet above (which is YAML syntax), there is a single level called key-perf-indicators collected every 5 seconds (more on levels in a moment). At this level, Blip collects everything configured under collect:, which is just two metrics in the status.global domain: Queries and Threads_running. Real plans a much larger, listing tens (or hunrdeds) of metrics from various domains. Now the quesiton burning in your mind: what are “levels”? A level is a group of metrics collected at a unique frequency. key-perf-indicators metrics are collected every 5 seconds: 5s, 10s, 15s, and so forth. That’s not very fancy! Every metrics collector collects metrics at some frequency. But consider this: . key-perf-indicators: freq: 5s collect: status.global: metrics: - Queries - Threads_running database-sizes: freq: 60s collect: size.data: options: exclude: test_db,dba_stuff metrics: # Automatic . Now the plan has two levels: the original key-perf-indicators plus database-sizes every 60 seconds. (The domain size.data “collects” [calculatues] data size metrics for databases and tables.) Blip combines levels automatically: at 55 seconds, Blip collects only key-perf-indicators metrics; but at 60 seconds, it collects key-perf-indicators metrics and database-sizes metrics. In technical terms, it collects every level where freq % T == 0, where T is the number of seconds elapsed. Now that’s fancy: with level plans, Blip collects different metrics at different frequencies. Levels aren’t just fancy, they’re more efficient and (potentially) less expensive. For example, calculating table sizes when there are thousands of tables can be relatively slow. Consequently, it’s neither wise nor necessary to collect them every few seconds like regular metrics. By relegating table size collection to a slower frequency, regular metrics collection remains fast and efficient. And if you pay for a hosted metrics graphhing solution, then table size metrics every few seconds is a waste of money (because table sizes don’t usually change that fast). Speaking of paying for a hosted metrics graphhing solution, you need to send the metrics somewhere, and anywhere is possible with pluggable metric sinks (or sinks for short). Blip has built-in sinks for SignalFx and Chronosphere, but the sink is an interface, which means its trivial to write a new sink for wherever you send your metrics. Even better: domains make it possible to programmatically transform and rename metrics from Blip to any data format or protocol because Blip metrics have a consistent naming schema: lowercase domain.metric For example, status.global.threads_running. Your sink might strip the domain prefix, or rename it. It could also add labels, dimensions, and so forth—there are no limits. After collecting metrics specified by the plan, Blip passes them (in a simple data structure) to each sink, which are free to do anything (or nothing) with the metrics. Keep learning: Sinks ↓ . ",
    "url": "http://localhost:4000/v1.0/intro/concepts",
    "relUrl": "/v1.0/intro/concepts"
  },"15": {
    "doc": "Config File",
    "title": "Config File",
    "content": "Blip configuration is specified in a single YAML file (see Specifying a Config File). Concetpually, the Blip config file has three parts as shown and defined below. --- # Server config # Monitor defaults # Monitors monitors: [] . Server config Top-level sections that configure the blip instance, which is called the “server”: API, monitor loading, and so forth Monitor defaults Top-level sections that provide default values for each monitor: hostname, username, and so on Monitors List items under the monitors section, one for each MySQL instance to monitor: hostname, username, and so on A simple Blip config file for monitoring a single MySQL instance looks like: . monitors: - hostname: db.local username: metrics password: \"myVerySecurePassword\" . Since no server config is specified, blip uses built-in defaults (see Zero Config), which is probably fine for the server. { config.go } . ",
    "url": "http://localhost:4000/v1.0/config/config-file#config-file",
    "relUrl": "/v1.0/config/config-file#config-file"
  },"16": {
    "doc": "Config File",
    "title": "Conventions",
    "content": "To reference sections, subsections, and specific user-configurable variables within those sections: . SECTION Any top-level section. For example: api, plans, and monitors. SECTION[.SUB...].VAR A user-configurable variable in the SECTION with optional subections (SUB). For example: mysql.username (section = mysql, variable = username), or monitors.heartbeat.freq (section = ‘monitors’, subsection = ‘heartbeat’, variable = ‘freq`). Note the difference between heartbeat and monitors.heartbeat: the former is the top-level monitor default; the latter is a monitor config that inherts the monitor defaults, if any. Outside this section of the docs, we prefix all config references with config.. For example, elsewhere in the docs, we write config.api to make it clear that we’re refering to the api section of the Blip config file. All section and variable names are lowercase-and-hyphenated. (But string values that you specifiy can by anything you want.) . disable and disable-auto-... are used to disable features. There are no “enable” prefixes or variables. Instead, some features of either off or auto by default. If off by default, the feature is enabled by specifying a variable noted in the docs. For example, heartbeat is off by default and enabled when heartbeat.freq is specififed. If auto by default, the feature is disabled by specifying disable-auto-FEATURE: true, where FEATURE is the feature name. For example, aws-rds.disable-auto-region: true to disable auto-detecting the AWS region. ",
    "url": "http://localhost:4000/v1.0/config/config-file#conventions",
    "relUrl": "/v1.0/config/config-file#conventions"
  },"17": {
    "doc": "Config File",
    "title": "Interpolation",
    "content": "Blip automatically interploates environment variables and monitor variables in the config file and plans. Environment variable ${FOO} Environment variable with default value ${FOO:-default} Monitor variable %{monitor.VAR} NOTE: ${} and %{} are always required. Environment variable interpolation is a simple implementation of the shell standard. In Blip, only the two cases shown above are supported, and default must be a literal value (it cannot be another ${}). Monitor variables are scoped to (only work within) a single monitor. For example: . monitors: - hostname: db.local username: metrics tags: hostname: %{monitor.hostname} . The result is monitors.tags.hostname = \"db.local\" because %{monitor.hostname} refers to the local monitors.hostname variable. Blip is remarkably flexible, so this works the other way, too: . monitors: - hostname: %{monitor.tags.hostname} username: metrics tags: hostname: db.local . The result is monitors.hostname = \"db.local\" because %{monitor.tags.hostname} refers to the local monitrs.tags.hostname variable. Singular “monitor” in %{monitor.VAR}, not plural, to emphasize that the reference is only to the single monitor in which it appears . %{monitor.VAR} references outside monitors or monitor defaults are ignored and reuslt in the literal string: “%{monitor.VAR}”. You can use both in a single value, like: . tls: ca: \"${SECRETS_DIR}/%{monitor.hostname}\" monitors: - hostname: db1 - hostname: db2 . Top-level tls.ca specifies a monitor default that applies to all monitors that don’t explicily set the varaible. If SECRETS_DIR = /secrets, the result is: . monitors: - hostname: db1 tls: ca: /secrets/db1 - hostname: db2 tls: ca: /secrets/db2 . ",
    "url": "http://localhost:4000/v1.0/config/config-file#interpolation",
    "relUrl": "/v1.0/config/config-file#interpolation"
  },"18": {
    "doc": "Config File",
    "title": "Server Config",
    "content": " ",
    "url": "http://localhost:4000/v1.0/config/config-file#server-config",
    "relUrl": "/v1.0/config/config-file#server-config"
  },"19": {
    "doc": "Config File",
    "title": "api",
    "content": "The api section configures the Blip API. api: bind: \"127.0.0.1:9070\" disable: false . bind . | Type | string | . | Valid values | addr:port, :port | . | Default value | 127.0.0.1:9070 | . The bind variable sets the interface address and port that the API listens on. disable . | Type | bool | . | Valid values | true, false | . | Default value | false | . The disable variable disables the Blip API. ",
    "url": "http://localhost:4000/v1.0/config/config-file#api",
    "relUrl": "/v1.0/config/config-file#api"
  },"20": {
    "doc": "Config File",
    "title": "monitor-loader",
    "content": "The monitor-loader section configures how Blip finds and loads MySQL instances. monitor-loader: freq: \"\" files: [] stop-loss: \"\" aws: regions: [] local: disable-auto: false disable-auto-root: false . freq . | Type | string | . | Valid values | Go duration string | . | Default value |   | . The freq variable enables automatic monitor reloading. It’s off by default, which means moniitors are loaded only once at startup. files . | Type | list of strings | . | Valid values | file names | . | Default value |   | . The files variable specifies YAML files to load monitors from. Each file must have a monitors section. stop-loss . | Type | string | . | Valid values | • “N%” (percentage) where N is an integer btween 0 and 100 (exclusive)• “N” where N is an integer greater than 0 | . | Default value |   | . The stop-loss variable enables the stop-lost feature. aws . regions . | Type | list of strings | . | Valid values | AWS region names | . | Default value |   | . The regions variable sets which AWS regions to query for RDS intances. local . The local subsection has only two variables: . disable-auto: true disable-auto-root: true . ",
    "url": "http://localhost:4000/v1.0/config/config-file#monitor-loader",
    "relUrl": "/v1.0/config/config-file#monitor-loader"
  },"21": {
    "doc": "Config File",
    "title": "strict",
    "content": "| Type | bool | . | Valid values | true, false | . | Default value | false | . The strict variable enables strict mode, which is disabled by default. In strict mode, Blip returns certains errors rather than ignoring them. ",
    "url": "http://localhost:4000/v1.0/config/config-file#strict",
    "relUrl": "/v1.0/config/config-file#strict"
  },"22": {
    "doc": "Config File",
    "title": "Monitor Defaults",
    "content": "Monitor defaults are top-level sections that set default values for monitors that do not set an explicit value. Monitor defaults are useful when you have several MySQL instances to monitor and the configuration only differs by basic connection parameters, like hostname or socket. For example, imagine that you have 10 monitors all with the same username and password. Instead of setting username and password in all 10 monitors, you can set these variables once in the top-level mysql section: . mysql: username: \"defaultUser\" password: \"defaultPass\" monitors: - hostname: db1 # ... - hostname: db10 . The default username and password are applied to the 10 monitors because none of them explicitly set these variables. If a monitor explicitly sets one of the variables, then its explicit value is used instead of the default value. Monitor defaults are convenient, but explicit monitor configuraiton is more clear, so use monitor defatuls sparingly. The intended use case is for variables that must be consistent for all monitors. For example, if Blip monitors Amazon RDS instances in region us-east-1, then setting monitor default aws-rds.region: \"us-east-1\" makes sense. ",
    "url": "http://localhost:4000/v1.0/config/config-file#monitor-defaults",
    "relUrl": "/v1.0/config/config-file#monitor-defaults"
  },"23": {
    "doc": "Config File",
    "title": "aws-rds",
    "content": "The aws-rds section configures Amazon RDS for MySQL. aws-rds: iam-auth-token: false password-secret: \"\" region: \"\" disable-auto-region: false disable-auto-tls: false . iam-auth-token . | Type | bool | . | Valid values | true or false | . | Default value | false | . The iam-auth-token variable enables IAM database authentication. When enabled, IAM authentication is the prefered authentication method . password-secret . | Type | string | . | Valid values | AWS Secrets Manager ARN | . | Default value |   | . The password-secret variables sets the AWS Secrets Manager ARN that contains the MySQL user password. region . | Type | string | . | Valid values |   | . | Default value |   | . The region variable sets the AWS region. disable-auto-region . | Type | string | . | Valid values | true or false | . | Default value | false | . The disable-auto-region variable enables/disables automatic detection of the AWS region. disable-auto-tls . | Type | string | . | Valid values | true or false | . | Default value | false | . The disable-auto-tls variables enables/disables automatic use of the Amazon RDS certifcate authority (CA). By default, Blip uses the 2019 AWS RDS CA, which is built-in (you don’t need to configure anything). See AWS for details. ",
    "url": "http://localhost:4000/v1.0/config/config-file#aws-rds",
    "relUrl": "/v1.0/config/config-file#aws-rds"
  },"24": {
    "doc": "Config File",
    "title": "exporter",
    "content": "The exporter section configure Blip to emulate Prometheus mysqld_exporter. exporter: mode: \"\" flags: web.listen-address: \"127.0.0.1:9104\" web.telemetry-path: \"/metrics\" . mode . | Type | string | . | Valid values | dual or legacy | . | Default value |   | . The mode variables enables the Prometheus emualation feature. When set to dual, Blip runs normally and emulates Prometheus. When set to legacy, Blip runs only emulates Prometheus. The feature is disabled by default. flags . | Type | key-value map (string: string) | . | Valid values | (see list below) | . | Default value | (see list below) | . The flag variable is a key-value map of strings for certain Prometheus mysqld_exporter flags: . | web.listen-address (default: 127.0.0.1:9104) | web.telemetry-path (default: /metrics) | . ",
    "url": "http://localhost:4000/v1.0/config/config-file#exporter",
    "relUrl": "/v1.0/config/config-file#exporter"
  },"25": {
    "doc": "Config File",
    "title": "heartbeat",
    "content": "The heartbeat section configures the Blip heartbeat feature. heartbeat: freq: \"\" table: blip.heartbeat . freq . | Type | string | . | Valid values | Go duration string | . | Default value |   | . The freq variables sets how frequently heartbeats are written. See Hearbeat for details. table . | Type | string | . | Valid values | valid MySQL table name | . | Default value |   | . The table variables sets the Blip heartbeat table. The default database is blip if the table name is not database-qualified like db.heartbeat. ",
    "url": "http://localhost:4000/v1.0/config/config-file#heartbeat",
    "relUrl": "/v1.0/config/config-file#heartbeat"
  },"26": {
    "doc": "Config File",
    "title": "mysql",
    "content": "The mysql section configures how to connect to MySQL. mysql: hostname: \"\" mycnf: \"\" password: \"\" password-file: \"\" socket: \"\" timeout-connect: \"5s\" username: \"blip\" . This is the most important and common seciton since it configures how Blip connects to MySQL. It’s also the only section that becomes top-level in each monitor config: in a monitor config, omit mysql: and configure these variables at the top level. hostname . | Type | string | . | Valid values | hostname or hostname:port | . | Default value |   | . The hostname variable sets the MySQL hostname. mycnf . | Type | string | . | Valid values | my.cnf file name | . | Default value |   | . The mycnf variable sets a my.cnf file to read. Blip reads the [client] section of the my.cnf file: . | my.cnf File | Blip Variable | . | host | hostname | . | password | password | . | port | Appended to hostname | . | socket | socket | . | ssl-ca | tls.ca | . | ssl-cert | tls.cert | . | ssl-key | tls.key | . | user | username | . username . | Type | string | . | Valid values |   | . | Default value |   | . The username variable sets the MySQL username. password . | Type | string | . | Valid values |   | . | Default value |   | . The password variable sets the MySQL password. password-file . | Type | string | . | Valid values |   | . | Default value |   | . The password-file variable sets a file from which Blip reads the MySQL password. socket . | Type | string | . | Valid values |   | . | Default value |   | . The socket variable sets the MySQL socket. timeout-connect . | Type | string | . | Valid values | Go duration string | . | Default value |   | . The timeout-connect variable sets the connection timeout. ",
    "url": "http://localhost:4000/v1.0/config/config-file#mysql",
    "relUrl": "/v1.0/config/config-file#mysql"
  },"27": {
    "doc": "Config File",
    "title": "plans",
    "content": "The plans section configures the source of plans. plans: files: [\"plan.yaml\"] table: \"blip.plans\" monitor: {} adjust: # See below . files . | Type | list of strings | . | Valid values | file names | . | Default value | plans.yaml | . The files variable is a list of file names from which to load plans. Blip attempts to load the default, plans.yaml, but it is not required and does not cause an error if the file does not exist. Instead, in this case, Blip uses a default built-in plan. If plan files are explicitly configured, Blip only reads those plan files. monitor . | Type | dictonary | . | Valid values | Monitor | . | Default value |   | . The monitor variable configures the MySQL instance from which the table is loaded. table . | Type | string | . | Valid values | valid MySQL table name | . | Default value |   | . The table variable configures the MySQL table name from which plans are loaded. See . adjust . The adjust subection of the plan section configures the Level Plan Adjuster (LPA) feature. plans: adjust: offline: after: \"\" plan: \"\" standby: after: \"\" plan: \"\" read-only: after: \"\" plan: \"\" active: after: \"\" plan: \"\" . Each of the four sections (corresponding to the four connection states) have the same two variables: . after . | Type | string | . | Valid values | Go duration string | . | Default value |   | . The after variable sets how long before the state takes effect. plan . | Type | string | . | Valid values | plan name | . | Default value |   | . The plan variable sets the plan to load when the state takes effect. ",
    "url": "http://localhost:4000/v1.0/config/config-file#plans",
    "relUrl": "/v1.0/config/config-file#plans"
  },"28": {
    "doc": "Config File",
    "title": "sinks",
    "content": "The sinks section configures built-in metrics sinks and custom metrics sinks. This section is a map of maps: . sinks: sinkName1: option1: value1 sinkName2: option1: value1 . Blip has three built-in sinks named log, singalfx, and chronosphere. The options for each are listed below. chronosphere . | Key | Value | Default | . | url | Remote write URL | http://127.0.0.1:3030/openmetrics/write | . log . The Blip built-in log sink has no options. signalfix . | Key | Value | Default | . | auth-token | API authentication token |   | . | auth-token-file | File to read API auth token from |   | . ",
    "url": "http://localhost:4000/v1.0/config/config-file#sinks",
    "relUrl": "/v1.0/config/config-file#sinks"
  },"29": {
    "doc": "Config File",
    "title": "tags",
    "content": "The tags section sets user-defined key-value pairs (as strings) that are passed to each sink. For example (using interpolation): . tags: env: ${ENVIRONMENT:-dev} dc: ${DATACENTER:-local} hostname: %{monitor.hostname} . Blip calls these “tags”, but each sink might have a different term for the same concept. For example, with SignalFx these are called “dimensions”. But the concept is the same: metadata (usually string key-value pairs) attached to metrics that describe or annotate the metrics for grouping, aggregation, or filtering when display in graphs/charts. The built-in metrics sinks automatically send all tags with metrics. For example, the signalfx sink sends the tags as SingalFx dimensions. ",
    "url": "http://localhost:4000/v1.0/config/config-file#tags",
    "relUrl": "/v1.0/config/config-file#tags"
  },"30": {
    "doc": "Config File",
    "title": "tls",
    "content": "The tls section configures TLS certificates. tls: ca: \"\" cert: \"\" key: \"\" . You can specify only tls.ca, or tls.cert and tls.key, or all three; any other combination is invalid. By default, Blip does not use TLS for MySQL connections except when using AWS; see section aws-rds or AWS. ca . | Type | string | . | Valid values | file name | . | Default value |   | . The ca variables sets the certificate authority file. cert . | Type | string | . | Valid values | file name | . | Default value |   | . The cert variables sets the public certificate file. key . | Type | string | . | Valid values | file name | . | Default value |   | . The key variables sets the private key file. ",
    "url": "http://localhost:4000/v1.0/config/config-file#tls",
    "relUrl": "/v1.0/config/config-file#tls"
  },"31": {
    "doc": "Config File",
    "title": "Monitors",
    "content": "The monitors section is a list of MySQL instances to monitor. Each instance is a YAML dictionary containing any of the monitor default sections with one exception: mysql variables are top-level in a monitor. The example below shows two different MySQL instances to monitor. monitors: - hostname: db1.local username: metrics password-file: \"/secret/db-password\" heartbeat: freq: 1s - mycnf: \"/secret/my.cnf\" exporter: mode: legacy . The first MySQL instance is configured in lines 3-7. (Note the single, leading hyphen on line 3 that denotes an item in a YAML list.) The first three variables—hostname, username, and password-file—are mysql variables but in a monitor they are top-level. But all other sections, like heartbeat and its variable freq, are exactly the same in a monitor. The second MySQL instance is configured in lines 9-11. Variable mycnf belongs to section mysql, but again: in a monitor, mysql variables are top-level. Section exporter is exactly the same in a monitor. Refer to Monitor Defaults for configuring MySQL instances, and remember: mysql variables are top-level in a monitor (omit mysql: and include the variables directly). Monitors have two variables that only appear in monitors: id and meta. id . | Type | string | . | Valid values | any string | . | Default value | (automatic) | . The id variable uniquely identifies the MySQL instance in Blip. Every monitor has a unique ID that, by default, Blip sets automatically. You can set monitor IDs manually, but it’s better to let Blip set them automatically to avoid duplicates (which causes a fatal error). Blip uses monitor IDs to track and report each MySQL instance in its own output and API. Blip does not use monitor IDs to identify MySQL instances for reporting metrics, but you can use them if you want. For example: . monitors: - id: db1 hostname: db1.local tags: monitorId: %{monitor.id} . Since tags are passed to sinks (which report metrics), all sinks will receive the monitor ID. (Sinks receive the monitor ID at the code-level too, so technically this example is not necessary.) . Monitor IDs are not garuanteed to be stable—they might change between Blip versions. Therefore, do not rely on them outside of Blip for truly stable, unique MySQL instance identification. meta . | Type | key-value map (string: string) | . | Valid values | any strings | . | Default value |   | . The meta variable is a map of key-value strings extrensic to Blip. “Extrensic to Blip” is a fancy but succinct way of saying that meta data is not used by Blip, but it can be used by you. For example by contrast, all other variables are used by Blip in some way, for some purpose. But not meta. However, you can still reference meta in the config file and plans: %{monitor.meta.KEY}. meta solves at least one problem: passing the source DSN for a replica from monitor config to plan. Imagine you have two MySQL instances: source.db and replica.db, where the latter replicates from the former. Problem is: there is no configuration section to define the source MySQL instance. Configuring replication sources in Blip is not an easy problem to solve because replication topologies change when replicas are used for high availability, and MySQL Group Replication has different requirements. To solve this problem, you configure the source DSN in meta: . monitors: - hostname: replica.db meta: source-host: source.db source-user: repl source-pass: pleaseDontLag . You could configure it in tags, too, but tags are copied to sinks whereas metadata is not. Therefore, this configuration is better placed in meta than tags. Then in the plan, reference the metadata: . replication: freq: 5s collect: repl: options: source-host: %{monitor.meta.source-host} source-user: %{monitor.meta.source-user} source-pass: %{monitor.meta.source-pass} metrics: - lag . ",
    "url": "http://localhost:4000/v1.0/config/config-file#monitors",
    "relUrl": "/v1.0/config/config-file#monitors"
  },"32": {
    "doc": "Config File",
    "title": "Config File",
    "content": ". | Config File | Conventions | Interpolation | Server Config . | api . | bind | disable | . | monitor-loader . | freq | files | stop-loss | aws | regions | local | . | strict | . | Monitor Defaults . | aws-rds . | iam-auth-token | password-secret | region | disable-auto-region | disable-auto-tls | . | exporter . | mode | flags | . | heartbeat . | freq | table | . | mysql . | hostname | mycnf | username | password | password-file | socket | timeout-connect | . | plans . | files | monitor | table | adjust . | after | plan | . | . | sinks . | chronosphere | log | signalfix | . | tags | tls . | ca | cert | key | . | . | Monitors . | id | meta | . | . ",
    "url": "http://localhost:4000/v1.0/config/config-file",
    "relUrl": "/v1.0/config/config-file"
  },"33": {
    "doc": "Configure",
    "title": "Configure",
    "content": " ",
    "url": "http://localhost:4000/v1.0/config/",
    "relUrl": "/v1.0/config/"
  },"34": {
    "doc": "Conventions",
    "title": "Conventions",
    "content": "Blip conventions provide consistency and structure to make writing plans and reporting metrics easier. Although the built-in sinks report fully-qualified metric names (status.global.threads_running), your custom sink can rename and report metrics however you want. For example, your sink could ignore Blip domains completely and report only metric names (threads_running), or report a simpler custom prefix (mysql.threads_running). | Metrics . | Naming | Types | Values | Units | . | Collector Metrics | Domain Naming . | Sub-domains | . | . ",
    "url": "http://localhost:4000/v1.0/metrics/conventions",
    "relUrl": "/v1.0/metrics/conventions"
  },"35": {
    "doc": "Conventions",
    "title": "Metrics",
    "content": "Naming . Blip strives to report MySQL metric names as-is—no modifications—so that what you see in MySQL is what you get in Blip. However, MySQL metric names are very inconsistent: . | Foo_bar (most common) | Foo_Bar (replica status) | foo_bar (InnoDB metrics) | foo_bar_count (type suffix) | foo_bar_usec (unit suffix) | . For consistency, Blip metric names have three requirements: . | Only snake_case | Always lowercase | No prefixes or suffixes | . A fully-qualified metric name includes a domain: status.global.threads_running. The metric name is always the last field (split on .). Types . Blip metric types are standard: . | UNKNOWN | COUNTER | GAUGE | BOOL | EVENT | . Most metrics are counters; a few are gauges. Blip, like MySQL, does not distinguish between “counter” and “cumulative counter”. Blip counter metrics can reset to zero if MySQL is restarted; otherwise, the value only increases. Currently, Blip does not report bool or event metrics, but these are reserved for future use. The unknown type is used only for error detection. Values . All values, regardless of type, are float64. Units . MySQL metrics use a variety of units—from picoseconds to seconds. When the MySQL metric unit is documented and consistent, Blip reports the value as-is. For example, innodb.buffer_flush_avg_time is documented as “Avg time (ms) spent for flushing recently.”, therefore Blip reports the value as-is: as milliseconds. When the MySQL metric unit is variable, Blip uses the following units: . | Metric Type | Unit | . | Query time | microseconds (μs) | . | Lock time | microseconds (μs) | . | Wait time | microseconds (μs) | . | Replication (lag) | milliseconds (ms) | . | Data size | bytes | . For example, query response time ranges from nanoseconds to seconds (with microsecond precision) depending on the source. But regardless of the source, Blip reports query.*.response_time as microseconds (μs). To convert units, use the TransformMetrics plugin or write a custom sink. Blip does not suffix metric names with units, and it does not strip the few MySQL metrics that have unit suffixes. ",
    "url": "http://localhost:4000/v1.0/metrics/conventions#metrics",
    "relUrl": "/v1.0/metrics/conventions#metrics"
  },"36": {
    "doc": "Conventions",
    "title": "Collector Metrics",
    "content": "Most metrics are MySQL metrics: Blip simply reports the MySQL metric (after making it lowercase). For example, MySQL metric Threads_running is simply threads_running, and InnoDB metric trx_rseg_history_len is simply trx_rseg_history_len. Even in cases like trx_rseg_history_len, Blip never renames MySQL metrics to something more friendly, like history_list_length, which the MySQL metric really represents. Blip never renames MySQL metrics. MySQL metrics are not listed in Domains; see the listed MySQL sources for metrics. Collector metrics are metrics created by the collector, usually derived from MySQL metrics. For example, the repl.lag collector reports a metric named lag. There is no MySQL metric by that name; it’s created by the collector. To rename metrics, use the TransformMetrics plugin or write a custom sink. ",
    "url": "http://localhost:4000/v1.0/metrics/conventions#collector-metrics",
    "relUrl": "/v1.0/metrics/conventions#collector-metrics"
  },"37": {
    "doc": "Conventions",
    "title": "Domain Naming",
    "content": "Blip metric domain names have three requirements: . | Always lowercase | One word: [a-z]+ | Singular noun: “size” not “sizes”; “query” not “queries” | . Common abbreviation and acrynomym are prefered, especially when they match MySQL usage: “thd” not “thread”; “pfs” not “performanceschema”; and so on. Currently, domain names fit this convention, but if a need arises to allow hyphenation (“domain-name”), it might be allowed. Snake case (“domain_name”) and camel case (“domainName”) are not allowed: the former is used by metrics, and the latter is not Blip style. Sub-domains . Blip uses sub-domains for two purposes: MySQL-grouped metrics, or metrics that are related but different. The error domain is an exmaple of metrics that are related by different. error.query and error.repl both comprise error-related metrics, hence the common root domain, but the specific metrics for each are different. Thestatus domain is an example of MySQL-grouped metrics. MySQL provides status metrics grouped by account, global, host, thread, and user. (Global is the most common, as in SHOW GLOBAL STATUS.) Blip has a sub-domain for each group—status.account, status.global, and so on—that makes advacned plans like the following possible: . level: collect: status.global: options: all: yes status.host: options: host: 10.1.1.1 metrics: - queries - threads_running . The plan snippet above collects all global status metrics (status.global) but only two status metrics for host 10.1.1.1 (status.host). MySQL-grouped metrics are an explicit group: status.host explicitly groups by host. See Reporting &gt; Groups for more details. For simplicitly, sub-domains are called “domains” in the rest of the docs. The term is only used here to clarify the distinction and usage. ",
    "url": "http://localhost:4000/v1.0/metrics/conventions#domain-naming",
    "relUrl": "/v1.0/metrics/conventions#domain-naming"
  },"38": {
    "doc": "Blip",
    "title": "Blip",
    "content": "A running instance of the blip binary is a server. Internally, it’s a singleton instances of a Server data type. ",
    "url": "http://localhost:4000/v1.0/server/core",
    "relUrl": "/v1.0/server/core"
  },"39": {
    "doc": "Blip",
    "title": "Startup",
    "content": "Blip boots then runs. Command line option --run=false stop it from running. Monitors . Monitors have indepdent of the server. A monitor can . ",
    "url": "http://localhost:4000/v1.0/server/core#startup",
    "relUrl": "/v1.0/server/core#startup"
  },"40": {
    "doc": "Blip",
    "title": "Controls",
    "content": ". | Command line | API | Plan Loader | Monitor Loader | Sighnal handlers | . ",
    "url": "http://localhost:4000/v1.0/server/core#controls",
    "relUrl": "/v1.0/server/core#controls"
  },"41": {
    "doc": "Custom",
    "title": "Custom Sink",
    "content": " ",
    "url": "http://localhost:4000/v1.0/sinks/custom#custom-sink",
    "relUrl": "/v1.0/sinks/custom#custom-sink"
  },"42": {
    "doc": "Custom",
    "title": "Custom",
    "content": " ",
    "url": "http://localhost:4000/v1.0/sinks/custom",
    "relUrl": "/v1.0/sinks/custom"
  },"43": {
    "doc": "Db Maker",
    "title": "Db Maker",
    "content": "The database connection factory—db maker for short—makes connections to MySQL. ",
    "url": "http://localhost:4000/v1.0/server/db-maker",
    "relUrl": "/v1.0/server/db-maker"
  },"44": {
    "doc": "Db Maker",
    "title": "Authentication",
    "content": ". | Amazon RDS IAM authentication (config.aws-rds.iam-auth-token) | Amazon Secrets Manager (config.aws-rds.password-secret) | TLS certificate (config.tls) | Password file (config.mysql.password-file) | my.cnf (config.mysql.mycnf) | Password (config.mysql.password) | No password | . Source code: dbconn/factory.go . ",
    "url": "http://localhost:4000/v1.0/server/db-maker#authentication",
    "relUrl": "/v1.0/server/db-maker#authentication"
  },"45": {
    "doc": "Db Maker",
    "title": "Password Reloading",
    "content": "Blip automatically reloads the password for all authentication methods. It uses go-mysql/hotswap-dsn-driver. ",
    "url": "http://localhost:4000/v1.0/server/db-maker#password-reloading",
    "relUrl": "/v1.0/server/db-maker#password-reloading"
  },"46": {
    "doc": "Defaults",
    "title": "Default Metrics",
    "content": "Blip collects over 70 metrics by default—see Default Plans. To collect different metrics, first see which metric domains Blip collects, then write and use a new plan to collect the metrics you need. ",
    "url": "http://localhost:4000/v1.0/metrics/defaults#default-metrics",
    "relUrl": "/v1.0/metrics/defaults#default-metrics"
  },"47": {
    "doc": "Defaults",
    "title": "Defaults",
    "content": " ",
    "url": "http://localhost:4000/v1.0/metrics/defaults",
    "relUrl": "/v1.0/metrics/defaults"
  },"48": {
    "doc": "Defaults",
    "title": "Default Plans",
    "content": " ",
    "url": "http://localhost:4000/v1.0/plans/defaults#default-plans",
    "relUrl": "/v1.0/plans/defaults#default-plans"
  },"49": {
    "doc": "Defaults",
    "title": "Blip",
    "content": "--- performance: freq: 5s collect: innodb: metrics: - trx_active_transactions - lock_timeouts - lock_row_lock_current_waits - lock_row_lock_waits - lock_row_lock_time - buffer_flush_adaptive_total_pages - buffer_LRU_batch_flush_total_pages - buffer_flush_background_total_pages - log_lsn_checkpoint_age_total - log_max_modified_age_async - innodb_os_log_pending_writes - innodb_log_waits - trx_rseg_history_len - lock_deadlocks status.global: metrics: - queries - threads_running - com_begin - com_commit - com_rollback - com_select - com_delete - com_delete_multi - com_insert - com_insert_select - com_replace - com_replace_select - com_update - com_update_multi - innodb_data_reads - innodb_data_writes - innodb_data_written - innodb_data_read - innodb_buffer_pool_read_requests - innodb_buffer_pool_reads - Innodb_buffer_pool_wait_free - innodb_buffer_pool_pages_dirty - innodb_buffer_pool_pages_free - innodb_buffer_pool_pages_total - innodb_buffer_pool_pages_flushed - innodb_os_log_written additional: freq: 20s collect: status.global: metrics: - created_tmp_disk_tables - created_tmp_tables - created_tmp_files - connections - threads_connected - max_used_connections - bytes_sent - bytes_received - binlog_cache_disk_use - prepared_stmt_count - com_stmt_execute - com_stmt_prepare - aborted_clients - aborted_connects - select_full_join - select_full_range_join - select_range_check - select_scan - com_flush - com_kill - com_purge - com_admin_commands - com_show_processlist - com_show_slave_status - com_show_status - com_show_variables - com_show_warnings data-size: freq: 5m collect: size.binlogs: {} size.data: {} sysvars: freq: 15m collect: var.global: metrics: - max_connections - max_prepared_stmt_count - innodb_log_file_size . ",
    "url": "http://localhost:4000/v1.0/plans/defaults#blip",
    "relUrl": "/v1.0/plans/defaults#blip"
  },"50": {
    "doc": "Defaults",
    "title": "Prometheus",
    "content": " ",
    "url": "http://localhost:4000/v1.0/plans/defaults#prometheus",
    "relUrl": "/v1.0/plans/defaults#prometheus"
  },"51": {
    "doc": "Defaults",
    "title": "Defaults",
    "content": " ",
    "url": "http://localhost:4000/v1.0/plans/defaults",
    "relUrl": "/v1.0/plans/defaults"
  },"52": {
    "doc": "Domains",
    "title": "Domains",
    "content": "This page is the full domain list and reference. Blip collects only the domains and metrics specified in plans. Each domain that Blip currently implements begins with a table with these fields: . Blip version Blip version collector was added or changed. MySQL config . | no = No config required; all metrics available if MySQL default config | required = Metrics require MySQL config as documented | optional = Limited metrics unless MySQL config as documented | . Sources Usual source of metrics, but might have mulitple sources. Group keys Metric groups. Omitted if collector does not group metrics. Meta key-values Metric meta Omitted if collector does not set meta. Collector metrics Collector metrics. Omitted if collector does not report derived metrics. Run blip --print-domains to list available domains and collector options. | access . | access.index | access.table | . | aria | autoinc | aws . | aws.rds | aws.aurora | . | azure | error . | error.global | error.query | error.repl | error.client | . | event . | event.stage | event.stmt | event.trx | event.wait | . | file | galera | gcp | gr | host | innodb . | innodb.mutex | . | mariadb | ndb | oracle | percona . | percona.userstat.index | percona.userstat.table | . | processlist | pfs | pxc | query . | query.global | query.id | . | repl . | repl.lag | . | rocksdb | size . | size.binlog | size.data | size.index | size.file | . | status . | status.account | status.global | status.host | status.thread | status.user | . | thd | tls | tokudb | var.global | . ",
    "url": "http://localhost:4000/v1.0/metrics/domains",
    "relUrl": "/v1.0/metrics/domains"
  },"53": {
    "doc": "Domains",
    "title": "access",
    "content": "Access statistics . Not implemented yet but planned. access.index . Index access statistics . Not implemented yet but planned. (Metrics from sys.schema_index_statistics.) . access.table . Table access statistics . Not implemented yet but planned. (Metrics from sys.schema_table_statistics.) . ",
    "url": "http://localhost:4000/v1.0/metrics/domains#access",
    "relUrl": "/v1.0/metrics/domains#access"
  },"54": {
    "doc": "Domains",
    "title": "aria",
    "content": "MariaDB Aria Storage Engine . Reserved for future use. ",
    "url": "http://localhost:4000/v1.0/metrics/domains#aria",
    "relUrl": "/v1.0/metrics/domains#aria"
  },"55": {
    "doc": "Domains",
    "title": "autoinc",
    "content": "Auto-increment Columns . Not implemented yet but planned. ",
    "url": "http://localhost:4000/v1.0/metrics/domains#autoinc",
    "relUrl": "/v1.0/metrics/domains#autoinc"
  },"56": {
    "doc": "Domains",
    "title": "aws",
    "content": "Amazon Web Services . aws.rds . Amazon RDS for MySQL . Not implemented yet but planned. aws.aurora . Amazon Aurora . Not implemented yet but planned. ",
    "url": "http://localhost:4000/v1.0/metrics/domains#aws",
    "relUrl": "/v1.0/metrics/domains#aws"
  },"57": {
    "doc": "Domains",
    "title": "azure",
    "content": "Microsoft Azure . Reserved for future use. ",
    "url": "http://localhost:4000/v1.0/metrics/domains#azure",
    "relUrl": "/v1.0/metrics/domains#azure"
  },"58": {
    "doc": "Domains",
    "title": "error",
    "content": "MySQL, Client, and Query Errors . Not implemented yet but planned. error.global . error.query . error.repl . error.client . ",
    "url": "http://localhost:4000/v1.0/metrics/domains#error",
    "relUrl": "/v1.0/metrics/domains#error"
  },"59": {
    "doc": "Domains",
    "title": "event",
    "content": "MySQL Events . Reserved for future use. event.stage . event.stmt . event.trx . event.wait . ",
    "url": "http://localhost:4000/v1.0/metrics/domains#event",
    "relUrl": "/v1.0/metrics/domains#event"
  },"60": {
    "doc": "Domains",
    "title": "file",
    "content": "Files and Tablespaces . Reserved for future use. ",
    "url": "http://localhost:4000/v1.0/metrics/domains#file",
    "relUrl": "/v1.0/metrics/domains#file"
  },"61": {
    "doc": "Domains",
    "title": "galera",
    "content": "Percona XtraDB Cluster and MariaDB Cluster (wsrep) . Reserved for future use. ",
    "url": "http://localhost:4000/v1.0/metrics/domains#galera",
    "relUrl": "/v1.0/metrics/domains#galera"
  },"62": {
    "doc": "Domains",
    "title": "gcp",
    "content": "Google Cloud . Reserved for future use. ",
    "url": "http://localhost:4000/v1.0/metrics/domains#gcp",
    "relUrl": "/v1.0/metrics/domains#gcp"
  },"63": {
    "doc": "Domains",
    "title": "gr",
    "content": "MySQL Group Replication . Reserved for future use. ",
    "url": "http://localhost:4000/v1.0/metrics/domains#gr",
    "relUrl": "/v1.0/metrics/domains#gr"
  },"64": {
    "doc": "Domains",
    "title": "host",
    "content": "Host (Client) . Reserved for future use. ",
    "url": "http://localhost:4000/v1.0/metrics/domains#host",
    "relUrl": "/v1.0/metrics/domains#host"
  },"65": {
    "doc": "Domains",
    "title": "innodb",
    "content": "InnoDB Metrics . | Blip version | v1.0.0 | . | MySQL config | maybe | . | Sources | I_S | . | Group keys |   | . | Meta | subsystem=SUBSYSTEM column | . Metrics from INFORMATION_SCHEMA.INNODB_METRICS. innodb.mutex . InnoDB Mutexes . Reserved for future use. (Metrics from SHOW ENGINE INNODB MUTEX.) . ",
    "url": "http://localhost:4000/v1.0/metrics/domains#innodb",
    "relUrl": "/v1.0/metrics/domains#innodb"
  },"66": {
    "doc": "Domains",
    "title": "mariadb",
    "content": "MariaDB Enhancements . Reserved for future use. ",
    "url": "http://localhost:4000/v1.0/metrics/domains#mariadb",
    "relUrl": "/v1.0/metrics/domains#mariadb"
  },"67": {
    "doc": "Domains",
    "title": "ndb",
    "content": "MySQL NDB Cluster . Reserved for future use. ",
    "url": "http://localhost:4000/v1.0/metrics/domains#ndb",
    "relUrl": "/v1.0/metrics/domains#ndb"
  },"68": {
    "doc": "Domains",
    "title": "oracle",
    "content": "Oracle Cloud and Enterprise Enhancements . Reserved for future use. ",
    "url": "http://localhost:4000/v1.0/metrics/domains#oracle",
    "relUrl": "/v1.0/metrics/domains#oracle"
  },"69": {
    "doc": "Domains",
    "title": "percona",
    "content": "Percona Server Enhancements . Metrics from Percona User Statistics. percona.userstat.index . Percona userstat Index Statistics . | Blip version | v1.0.0 | . | MySQL config | yes | . | Sources | INFORMATION_SCHEMA.INDEX_STATISTICS | . | Group keys |   | . | Meta |   | . percona.userstat.table . Percona userstat Table Statistics . | Blip version | v1.0.0 | . | MySQL config | yes | . | Sources | INFORMATION_SCHEMA.TABLE_STATISTICS | . | Group keys |   | . | Meta |   | . ",
    "url": "http://localhost:4000/v1.0/metrics/domains#percona",
    "relUrl": "/v1.0/metrics/domains#percona"
  },"70": {
    "doc": "Domains",
    "title": "processlist",
    "content": "Processlist . Reserved for future use. (Metrics from SHOW PROCESSLIST or I_S.PROCESSLIST.) . ",
    "url": "http://localhost:4000/v1.0/metrics/domains#processlist",
    "relUrl": "/v1.0/metrics/domains#processlist"
  },"71": {
    "doc": "Domains",
    "title": "pfs",
    "content": "Performance Schema . Reserved for future use. (Metrics from SHOW ENGINE PERFORMANCE_SCHEMA STATUS.) . ",
    "url": "http://localhost:4000/v1.0/metrics/domains#pfs",
    "relUrl": "/v1.0/metrics/domains#pfs"
  },"72": {
    "doc": "Domains",
    "title": "pxc",
    "content": "Percona XtraDB Cluster . Reserved for future use, or use galera. ",
    "url": "http://localhost:4000/v1.0/metrics/domains#pxc",
    "relUrl": "/v1.0/metrics/domains#pxc"
  },"73": {
    "doc": "Domains",
    "title": "query",
    "content": "Query Metrics . query.global . Global Query Response Time . | Blip version | v1.0.0 | . | MySQL config | yes | . | Sources | MySQL 8.0 p_s.events_statements_histogram_global, Percona Server 5.7 RTD plugin | . | Group keys |   | . | Meta key-values | • pN=pA: where pN is configured percentile (default: p999) and pA is actual percentile (see note 1) | . | Collector metrics | • reponse_time (gauge) | . The query.global domain includes metrics for all queries, which is currently only response time. By default, it reports the P999 (99.9th percentile) reponse time using either MySQL 8.0 performance_schema.events_statements_histogram_global or Percona Server 5.7 Response Time Distribution plugin. Multiple percentiles can be collected—p95, p99, and p999 for example. The metric for each percentile is denoted by meta key pN. To convert units, use the TransformMetrics plugin or write a custom sink. Collector Metrics . | reponse_time Type: gauge Response time for all queries, reported as a percentile (default: P999) in microseconds. The true percentile might be slightly more or less depending on how the histogram buckets are configured (see note 1). | . Notes . | MySQL (and Percona Server) use histograms with varible bucket ranges. Therefore, the P99 might actually be P98.9 or P99.2. Meta key pN indicates the configured percentile, and its value pA indicates the actual percentile that was used. | . query.id . Not implemented yet. The query.id domain includes metrics for unique queries identified by digest SHA and set in meta as id. ",
    "url": "http://localhost:4000/v1.0/metrics/domains#query",
    "relUrl": "/v1.0/metrics/domains#query"
  },"74": {
    "doc": "Domains",
    "title": "repl",
    "content": "MySQL Replication . repl.lag . MySQL Replication Lag . | Blip version | v1.0.0 | . | Sources | Blip Heartbeat, Percona pt-heartbeat, or ~~MySQL | . | MySQL config | MySQL: no; other sources: yes | . | Group keys |   | . | Meta |   | . | Metrics | • max (gauge): Maximum replication lag (milliseconds) observed during collect interval. | . Requires option source in the plan; use %{monitor.meta.repl-source} like: . level: collect: repl.lag: options: source: \"%{monitor.meta.repl-source}\" . Then define config.monitor.meta.repl-source in the monitor meta: . monitors: - hostname: replica.db meta: repl-source: source.db . ",
    "url": "http://localhost:4000/v1.0/metrics/domains#repl",
    "relUrl": "/v1.0/metrics/domains#repl"
  },"75": {
    "doc": "Domains",
    "title": "rocksdb",
    "content": "RocksDB Store Engine . Reserved for future use. ",
    "url": "http://localhost:4000/v1.0/metrics/domains#rocksdb",
    "relUrl": "/v1.0/metrics/domains#rocksdb"
  },"76": {
    "doc": "Domains",
    "title": "size",
    "content": "Data, Index, and File Sizes . size.binlog . Binary Log Storage Size . | Blip version | v1.0.0 | . | Sources | SHOW BINARY LOGS | . | MySQL config | no | . | Group keys |   | . | Meta |   | . Collector Metrics . | bytes Type: gauge Total size of all binary logs in bytes. | . size.data . Database and Table Storage Size . | Blip version | v1.0.0 | . | MySQL config | no | . | Group keys | db, tbl | . | Meta |   | . size.index . Index Storage Size . size.file . File Storage Size . (Metrics innodb_undo and innodb_temp.) . ",
    "url": "http://localhost:4000/v1.0/metrics/domains#size",
    "relUrl": "/v1.0/metrics/domains#size"
  },"77": {
    "doc": "Domains",
    "title": "status",
    "content": "MySQL Status Variables . Classic MySQL status variables. status.account . Status by Account . Reserved for future use. status.global . Global Status Variables . | Blip version | v1.0.0 | . | MySQL config | no | . | Group keys |   | . | Meta |   | . Classic SHOW GLOBAL STATUS. Might used performance_schema.global_status table. status.host . Status by Host (Client) . Reserved for future use. status.thread . Status by Thread . Reserved for future use. status.user . Status by User . Reserved for future use. ",
    "url": "http://localhost:4000/v1.0/metrics/domains#status",
    "relUrl": "/v1.0/metrics/domains#status"
  },"78": {
    "doc": "Domains",
    "title": "thd",
    "content": "Threads . Reserved for future use. ",
    "url": "http://localhost:4000/v1.0/metrics/domains#thd",
    "relUrl": "/v1.0/metrics/domains#thd"
  },"79": {
    "doc": "Domains",
    "title": "tls",
    "content": "TLS (SSL) Status and Configuration . Not implemented yet but planned. Collector Metrics . | enabled (have_ssl) | ssl_server_not_before (date-time converted to Unix timestamp) | ssl_server_not_after (date-time converted to Unix timestamp) | current_tls_version | . ",
    "url": "http://localhost:4000/v1.0/metrics/domains#tls",
    "relUrl": "/v1.0/metrics/domains#tls"
  },"80": {
    "doc": "Domains",
    "title": "tokudb",
    "content": "TokuDB Storage Engine . Reserved for future use. ",
    "url": "http://localhost:4000/v1.0/metrics/domains#tokudb",
    "relUrl": "/v1.0/metrics/domains#tokudb"
  },"81": {
    "doc": "Domains",
    "title": "var.global",
    "content": "MySQL System Variables . | Blip version | v1.0.0 | . | Sources | SHOW, SELECT @@GLOBAL, p_s | . | MySQL config | no | . | Group keys |   | . | Meta |   | . Classic MySQL SHOW GLOBAL VARIBLES. ",
    "url": "http://localhost:4000/v1.0/metrics/domains#varglobal",
    "relUrl": "/v1.0/metrics/domains#varglobal"
  },"82": {
    "doc": "Engine",
    "title": "Engine",
    "content": " ",
    "url": "http://localhost:4000/v1.0/monitor/engine",
    "relUrl": "/v1.0/monitor/engine"
  },"83": {
    "doc": "File",
    "title": "Plan File",
    "content": "One YAML file specifies one Blip plan. ",
    "url": "http://localhost:4000/v1.0/plans/file#plan-file",
    "relUrl": "/v1.0/plans/file#plan-file"
  },"84": {
    "doc": "File",
    "title": "Syntax",
    "content": "Plan files use YAML syntax. The high-level pseudo structure is: . --- level-name: &lt;level config&gt; collect: &lt;domain name&gt;: &lt;domain config&gt; . That structure repeats for each level, which is given a unique name. Following is a small but realistic example: . --- performance: freq: 5s collect: status.global: options: all: yes metrics: # ALL because of option ^ innodb: metrics: - trx_rseg_history_len # HLL data-size: freq: 60m collect: data.size: # All defaults . The example above specifies two levels, “performance” and “data-size”. The “performance” level is collected every 5 seconds. For this level, Blip collect metrics from two domains: status.global and innodb. The “data-size” level is collected every 60 minutes. For this level, Blip collects metrics for one domain: data.size. When the two levels overlap (every 60 minutes), Blip collects metrics for both levels. The “data-size” level demonstrates the minimum valid level config: freq and at least one domain with all defaults. Level Config . | Parameter | Value | Required? | Purpose | . | collect | Domain Config | YES | Configures which domains and metrics to collect | . | freq | Go duration string | YES | Interval at which level is collected | . Domain Config . | Parameter | Value | Required? | Purpose | . | metrics | list of strings | no | List of metrics to collect; not required but common unless domain has option to collect all metrics, or only collects a fixed list of metrics | . | options | key-value pairs (strings) | no | Sets collector options | . Values for both metrics and options are domain (and collector) specific. See Domains for the latter, and Collectors &gt; Options for the latter. ",
    "url": "http://localhost:4000/v1.0/plans/file#syntax",
    "relUrl": "/v1.0/plans/file#syntax"
  },"85": {
    "doc": "File",
    "title": "Naming",
    "content": "Plan names are exactly as written in the plans section of the Blip config file. For example: . plans: files: - \"/blip/plan1.yaml\" - ../plan2.yaml - ${HOME}/plan3.yaml . The first plan name is /blip/plan1.yaml (Blip does not strip base paths). The second plan name is ../plan2.yaml (Blip does not replace relative paths). The third plan name is /home/user/plan3.yaml where HOME=/home/user because interpolation happens first. ",
    "url": "http://localhost:4000/v1.0/plans/file#naming",
    "relUrl": "/v1.0/plans/file#naming"
  },"86": {
    "doc": "File",
    "title": "Interpolation",
    "content": "Blip interpolates option values in the domain config. Interpolation in plan files is identical to interpolation in the config file (see Config File &gt; Interpolation). Environment variable ${FOO} Environment variable with default value ${FOO:-default} Monitor variable %{monitor.VAR} NOTE: ${} and %{} are always required. ",
    "url": "http://localhost:4000/v1.0/plans/file#interpolation",
    "relUrl": "/v1.0/plans/file#interpolation"
  },"87": {
    "doc": "File",
    "title": "File",
    "content": " ",
    "url": "http://localhost:4000/v1.0/plans/file",
    "relUrl": "/v1.0/plans/file"
  },"88": {
    "doc": "Heartbeat",
    "title": "Heartbeat",
    "content": "Blip has a built-in heartbeat feature for measuring replication lag. ",
    "url": "http://localhost:4000/v1.0/heartbeat",
    "relUrl": "/v1.0/heartbeat"
  },"89": {
    "doc": "Release Notes",
    "title": "Release Notes",
    "content": " ",
    "url": "http://localhost:4000/release-notes",
    "relUrl": "/release-notes"
  },"90": {
    "doc": "Release Notes",
    "title": "v1.0",
    "content": "v1.0.0 (not released yet) . | First GA, production-ready release. | . ",
    "url": "http://localhost:4000/release-notes#v10",
    "relUrl": "/release-notes#v10"
  },"91": {
    "doc": "Home",
    "title": "GitHub Repo",
    "content": "https://github.com/cashapp/blip . Official releases are tagged with version. Only the latest version is stable and supported. ",
    "url": "http://localhost:4000/#github-repo",
    "relUrl": "/#github-repo"
  },"92": {
    "doc": "Home",
    "title": "Support",
    "content": "For bugs and general issues, please create a new GitHub issue. If submitting code changes, please also see the contributing guide. ",
    "url": "http://localhost:4000/#support",
    "relUrl": "/#support"
  },"93": {
    "doc": "Home",
    "title": "Release Notes",
    "content": ". | Release Notes | . ",
    "url": "http://localhost:4000/#release-notes",
    "relUrl": "/#release-notes"
  },"94": {
    "doc": "Home",
    "title": "Home",
    "content": ". Blip is the most advanced MySQL metrics collector ever built. | Connects to MySQL anywhere—local, remote, bare metal, cloud | Monitors one or many MySQL instances per blip instance | Configurable metrics collection—metrics are not hard-coded | Different metric collection frequencies—collect metrics at different intervals | Built-in support for Amazon RDS include Secrets Manager and IAM authentication | Send metrics to any back end—built-in support for SignalFx and Chronosphere | Plugins and factories to integrate with any environment | . Start by reading the Introduction. Then read the Quick Start to give Blip a try. ",
    "url": "http://localhost:4000/",
    "relUrl": "/"
  },"95": {
    "doc": "Integrate",
    "title": "Integrate",
    "content": "Blip was designed from the ground up to integrate with your MySQL environment. To accomplish that, Blip has two mains points of integration: . Plugins Plugins are function callbacks that let you override specific functionality of Blip. Every plugin is optional: if specified, it overrides the built-in functionality. Factories Factories are interfaces that let you override certain object creation of Blip. Every factory is optional: if specified, it overrides the built-in factory. ",
    "url": "http://localhost:4000/v1.0/integrate",
    "relUrl": "/v1.0/integrate"
  },"96": {
    "doc": "Integrate",
    "title": "Plugins",
    "content": "LoadConfig . LoadConfig func(Config) (Config, error) . LoadMonitors . LoadMonitors func(Config) ([]ConfigMonitor, error) . LoadLevelPlans . LoadLevelPlans func(ConfigPlans) ([]Plan, error) . ModifyDB . ModifyDB func(*sql.DB) . TransformMetrics . TransformMetrics func(*Metrics) error . ",
    "url": "http://localhost:4000/v1.0/integrate#plugins",
    "relUrl": "/v1.0/integrate#plugins"
  },"97": {
    "doc": "Introduction",
    "title": "Introduction to Blip",
    "content": " ",
    "url": "http://localhost:4000/v1.0/intro/#introduction-to-blip",
    "relUrl": "/v1.0/intro/#introduction-to-blip"
  },"98": {
    "doc": "Introduction",
    "title": "Introduction",
    "content": " ",
    "url": "http://localhost:4000/v1.0/intro/",
    "relUrl": "/v1.0/intro/"
  },"99": {
    "doc": "Laptop",
    "title": "Laptop",
    "content": "Presuming a standard MySQL insstance runs on your laptop, first create a blip user: . CREATE USER IF NOT EXISTS 'blip' IDENTIFIED BY ''; -- no password GRANT SELECT ON `performance_schema`.* TO 'blip'@'%'; -- no privlieges . Then run blip (after compiling it in bin/blip/, of course): . $ blip . By default, Blip automatically finds local MySQL instances, and tries a few default username-password combinations. If successful, it will dump metrics to STDOUT. If not successful, run with --debug. ",
    "url": "http://localhost:4000/v1.0/quick-start/laptop",
    "relUrl": "/v1.0/quick-start/laptop"
  },"100": {
    "doc": "Level Plan Adjuster",
    "title": "Level Plan Adjuster",
    "content": " ",
    "url": "http://localhost:4000/v1.0/monitor/level-adjuster",
    "relUrl": "/v1.0/monitor/level-adjuster"
  },"101": {
    "doc": "Level Plan Adjuster",
    "title": "Connection States",
    "content": "| State | Connected to MySQL | Collecting Metrics | Description | . | offline | no | no | Completely offline, no connection to MySQL | . | standby | YES | YES | Connected to MySQL but HA passive mode | . | read-only | YES | YES | MySQL is read-only | . | active | YES | YES | MySQL is writable | . When HA is disabled, standby state is not used. ",
    "url": "http://localhost:4000/v1.0/monitor/level-adjuster#connection-states",
    "relUrl": "/v1.0/monitor/level-adjuster#connection-states"
  },"102": {
    "doc": "Level Plan Collector",
    "title": "Level Plan Collector",
    "content": " ",
    "url": "http://localhost:4000/v1.0/monitor/level-collector",
    "relUrl": "/v1.0/monitor/level-collector"
  },"103": {
    "doc": "Metrics",
    "title": "Metrics",
    "content": " ",
    "url": "http://localhost:4000/v1.0/metrics/",
    "relUrl": "/v1.0/metrics/"
  },"104": {
    "doc": "Monitor Loader",
    "title": "Monitor Loader",
    "content": " ",
    "url": "http://localhost:4000/v1.0/server/monitor-loader",
    "relUrl": "/v1.0/server/monitor-loader"
  },"105": {
    "doc": "Monitor Loader",
    "title": "Auto Reloading",
    "content": " ",
    "url": "http://localhost:4000/v1.0/server/monitor-loader#auto-reloading",
    "relUrl": "/v1.0/server/monitor-loader#auto-reloading"
  },"106": {
    "doc": "Monitor Loader",
    "title": "Stop-loss",
    "content": "Stop-loss is a feature of auto reloading that prevents Bip from dropping too many MySQL instances due to unrelated external issues. ",
    "url": "http://localhost:4000/v1.0/server/monitor-loader#stop-loss",
    "relUrl": "/v1.0/server/monitor-loader#stop-loss"
  },"107": {
    "doc": "Monitor",
    "title": "Monitor",
    "content": " ",
    "url": "http://localhost:4000/v1.0/monitor/",
    "relUrl": "/v1.0/monitor/"
  },"108": {
    "doc": "Monitors",
    "title": "Monitors",
    "content": "Every MySQL instance that Blip monitors is called a moniotr. For simplicity, the terms monitor and MySQL instance are synonymous because a monitor requires and represents only one MySQL instance. But there is more to a monitor than its MySQL instance. NOTE: Monitor and MySQL instance are synonymous in Blip. Monitors are usually specififed in the Blip config file, but they can be loaded various ways—more on this later. For now, it’s only necessary to know that monitors are listed in the YAML config file under the aptly named section moniotrs. The most basic Blip monitor is a simple hostname, username, and password: . monitors: - hostname: 127.0.0.1 username: blip password: aStrongRandomPassword . Or, if you want to use a my.cnf file: . monitors: - mycnf: ${HOME}/.my.cnf . A single Blip instances can monitor any number of MySQL instances. Here is a snippet of config that specifies three different MySQL instances: . monitors: - socket: /tmp/mysql.sock username: blip password-file: /dev/shm/metrics-password - hostname: 10.1.1.53 username: metrics password: foo - hostname: db3.us-east-1.amazonaws.com aws-rds: auth-token: true . The first instance is local: Blip connects using socket file /tmp/mysql.sock. The second instance is remote: Blip connects to IP 10.1.1.53. The third instance is an Amazon RDS for MySQL instance, and Blip uses IAM authentication. The point of these contrived examples is: Blip can monitor any MySQL instance anywhere it’s running. (If you have a case where this is not true, please file an issue.) . By default, Blip first attempts to load monitors from its config file (which is blip.yaml in the current working directory, by default). But the config file can specify other ways to load monitors: . monitor-loader: freq: 60s files: [monitors1.yaml, monitors2.yaml] . In short, that config snippet makes Blip load (read) monitor configuration from files monitors1.yaml and monitors2.yaml every 60 seconds. (Blip can dynamically load [add] and unload [remove] monitors while running.) The monitor-load config is optional; by default, Blip loads monitors from the monitors section in its config file. To further ensure that Blip can monitory any MySQL instance, loading monitors is an optional plugin with this callback signature: . LoadMonitors func(Config) ([]ConfigMonitor, error) . Hopefully, bilt-in features cover every use case, but if you have particular requirements (filtering out certain MySQL instances, for example), you can plug in your own code to load monitors. In addition to basic MySQL configuration—how to connect to MySQL: hostname, username, and password, and so forth—monitors have other optional features and configuration, summarized briefly in the following table. | Monitor Confg | Feature | . | aws | Amazon RDS authentication | . | exporter | Prometheus mysqld_exporter emulation | . | ha | High availability (not implemented yet) | . | heartbeat | Heartbeat to measure replication lag | . | meta | User-defined key-value data | . | plans | Monitor-specific plans for metrics collection | . | sinks | Monitors-specific sinks for sending metrics | . | tags | Monitor-specific key-value data passed to sinks | . | tls | TLS configuration | . That’s a lot of information, but the point is a lot simpler: Blip monitors can do almost anything. For the most part, these features support Blip in large, automated environments. If you don’t need a feature, you can forget about it: Blip is simple (and fully automatic) by default. When you need a feature, Blip most likely already supports it. One last helpful tip: . $ blip --print-moniotrs --run=false . The command line above starts (but does not run) Blip so that it loads monitors and prints them, then exists. This can help debug monitor loading and configuration. Keep learning: Plans ↓ . ",
    "url": "http://localhost:4000/v1.0/intro/monitors",
    "relUrl": "/v1.0/intro/monitors"
  },"109": {
    "doc": "Plan Loader",
    "title": "Plan Loader",
    "content": " ",
    "url": "http://localhost:4000/v1.0/server/plan-loader",
    "relUrl": "/v1.0/server/plan-loader"
  },"110": {
    "doc": "Plan Loader",
    "title": "Load Order",
    "content": "--- # Zero config #plans: #default: blip plans: files: first.yaml plans: files: [first.yaml,second.yaml] #default: first.yaml plans: files: [first.yaml,second.yaml] default: second.yaml plans: files: [first.yaml,second.yaml] adjust: freq: 1s readonly: first.yaml active: second.yaml plans: files: first.yaml:second.yaml default: first.yaml adjust: # ERROR: default and adjust mutually exclusive freq: 1s readonly: first.yaml active: second.yaml plans: files: first.yaml:second.yaml table: blip.plans plans: table: blip.plans # WHERE 1=1 (all rows) #default: WHERE monitorId IS NULL ORDER BY name ASC LIMIT 1 plans: table: blip.plans default: plan1 monitors: - id: host1 plans: table: blip.plans # WHERE monitorId=host1 #default: WHERE monitorId=host1 ORDER BY name ASC LIMIT 1 . ",
    "url": "http://localhost:4000/v1.0/server/plan-loader#load-order",
    "relUrl": "/v1.0/server/plan-loader#load-order"
  },"111": {
    "doc": "Plan Loader",
    "title": "Combining Levels",
    "content": "Levels are combined by the LPC (call stack): . sortedLevels() changePlan() . ",
    "url": "http://localhost:4000/v1.0/server/plan-loader#combining-levels",
    "relUrl": "/v1.0/server/plan-loader#combining-levels"
  },"112": {
    "doc": "Plans",
    "title": "Plans",
    "content": "A level plan (or plan for short) configures which metrics to collect. Plans solve three problems: . | Which metrics to collect? | How to collect those metrics? | How often to collect those metrics? | . The first problem arises because there are over 1,000 MySQL metrics but 0 standards for which metrics to collect. Some engineers collect nearly all metrics and use what they need in graphs. Some engineers collect as few metrics as possible due to costs. Some engineers don’t know what to collect, relying on monitor defaults to be useful. Plans help solve the first problem by not hard-coding which metcis to collect. Write a plan to collect only the metrics you need. Blip has a built-in default plan that collects more than 60 of the most important MySQL metrics, which might be all you need. The second problem arises because there are many versions and distributions of MySQL, which makes some metrics a moving target. For example: where do you collect a MySQL replication lag metric? The oldest and perhaps still most common source is Seconds_Behind_Master in the SHOW SLAVE STATUS output. But those two changed to Seconds_Behind_Source and SHOW REPLICA STATUS, respectively. And what if you don’t use those and, instead, use pt-heartbeat or the Blip built-in heartbeat? Or what if you’re running MySQL Group Replication? Or what if you run MySQL in the cloud and the cloud provider emits its own replication lag metric? . Plans help solve the second problem by using metric domains (or domains for short) to name logically-related group of MySQL metrics. Probably the most well known group is SHOW GLOBAL STATUS, to which Blip gives the domain name status.global. A replication lag metric is scoped within the repl domain (short for “replication”), which hides (abstarcts way) the technical details of how it’s collected. When you write a plan that collects replication lag, the plan works everywhere because domains specify which metrics to collect, not necessarily how to collect them. The third problem arises from cost and storage limits: if everything was fast and free, you would collect all metrics every 1 second. But this is (almost) never done because it requires signfiicant storage and processing, which lead to significant costs. Instead, the norm is collecting all metrics every 10, 20, or 30 seconds. But even 10 seconds is too long for a busy database because, for example, at only 5,000 QPS, that resolution averages out the metrics for 50,000 queries. Plans help solve the third problem by allowing you to collect different metrics at different frequencies—which is the “level” in the full term: “level plan”. It helps to remember as: “Higher the level, higher the wait (time between collection).” For example, imagine three levels as shown below. Level 1, the base level, is collected frqeuently (shortest wait time): every 5 seconds. Level 2 is collected less frequently: every 20 seconds. Level 3, the highest level, is collected the most infrequently (longest wait time): every 30 seconds. Blip automatically combines levels when they overlap and collects all metrics at that time. At 20 seconds (since Blip started collecting metrics for this plan), Blip collects metrics for both levels 1 and 2 because 20 mod 5 = 0 and 20 mod 20 = 0, respectively. At 30 seconds, Blip collects metrics for both levels 1 anbd 3 because 30 mod 5 = 0 and 30 mod 20 = 0, respectively. And at 60 seconds, Blip collecgts metrics for all three levels because 60 mod freq = 0. Blip plans can do more, but for this introduction it’s sufficient to know that they allow you to fine-tune metrics collection, which increases the quality of monitoring while reducing costs. Keep going: Quick Start ↓ . ",
    "url": "http://localhost:4000/v1.0/intro/plans",
    "relUrl": "/v1.0/intro/plans"
  },"113": {
    "doc": "Plans",
    "title": "Plans",
    "content": " ",
    "url": "http://localhost:4000/v1.0/plans/",
    "relUrl": "/v1.0/plans/"
  },"114": {
    "doc": "Prometheus",
    "title": "Prometheus",
    "content": "Blip can emulate Prometheus mysqld_exporter. ",
    "url": "http://localhost:4000/v1.0/prometheus",
    "relUrl": "/v1.0/prometheus"
  },"115": {
    "doc": "Quick Reference",
    "title": "Quick Reference",
    "content": "Interpolation . ${ENV_VAR} %{monitor.hostname} . Plan File . Following is a full Blip config file (YAML syntax). This is only a reference to show all configuration variables. --- level: freq: 5s collect: status.global: metrics: - queries status.host: options: host: 10.1.1.1 metrics: - threads_running query.global: options: response_time_percentiles: \"p95,p99,p999\" metrics: - response_time var: options: opt_1: value_1 opt_N: value_N metrics: - metric_1 - metric_N level_N: freq: 10s collect: domain_1: options: opt_1: value_1 opt_N: value_N metrics: - metric_1 - metric_N . ",
    "url": "http://localhost:4000/v1.0/plans/quick-ref",
    "relUrl": "/v1.0/plans/quick-ref"
  },"116": {
    "doc": "Quick Reference",
    "title": "Quick Reference",
    "content": "The following are quick references, not complete or valid examples. See Config File for details. Interpolation . ${ENV_VAR} %{monitor.hostname} . Config File . --- # --------------------------------------------------------------------------- # Blip server # --------------------------------------------------------------------------- api: bind: 127.1:7090 disable: false monitor-loader: freq: 60s files: [one.yaml, two.yaml] stop-loss: 50% aws: regions: [\"auto\",\"us-east-1\"] local: disable-auto: true disable-auto-root: true strict: true # --------------------------------------------------------------------------- # Defaults for monitors # --------------------------------------------------------------------------- aws-rds: iam-auth-token: true password-secret: \"arn::::\" region: \"us-east-1\" disable-auto-region: false disable-auto-tls: false exporter: mode: dual|legacy flags: web.listen-address: :9001 heartbeat: freq: 1s table: blip.heartbeat mysql: mycnf: my.cnf username: blip password: blip password-file: \"\" timeout-connect: 5s plans: files: - none.yaml - ro-plan.yaml - active-plan.yaml table: blip.plans monitor: &lt;monitor&gt; adjust: offline: after: 1s plan: none.yaml standby: after: 1s plan: none.yaml read-only: after: 1s plan: ro-plan.yaml active: after: 1s plan: active-plan.yaml sinks: retry: buffer-size: 60 send-timeout: 5s send-retry-wait: 200ms chronosphere: url: \"http://127.0.0.1:3030/openmetrics/write\" signalfx: auth-token: \"\" auth-token-file: \"\" log: # No options tags: env: ${ENVIRONMENT:-dev} dc: ${DATACENTER:-local} hostname: %{monitor.hostname} tls: ca: local.ca cert: /secrets/$%{monitor.hostname}.crt key: /secrets/%{monitor.hostname}.key # --------------------------------------------------------------------------- # MySQL instances to monitor # --------------------------------------------------------------------------- monitors: - id: host1 # mysql: hostname: host1.local socket: /tmp/mysql.sock mycnf: my.cnf username: metrics password: foo password-file: /dev/shm/mypasswd timeout-connect: 5s aws-rds: password-secret: \"arn::::\" iam-auth-token: true exporter: mode: dual|legacy flags: \"web.listen-address\": 127.0.0.1:9104 \"web.telemetry-path\": /metrics heartbeat: freq: 1s table: blip.heartbeat ha: # Reserved plans: table: \"blip.plans\" #monitor: &lt;monitor&gt; adjust: readonly: after: 2s plan: ro.yaml active: after: 1s plan: rw.yaml sinks: signalfx: auth-token: \"\" auth-token-file: \"\" log: # No options chronosphere: url: http://127.0.0.1:3030/openmetrics/write tags: env: staging monitor-id: %{monitor.id} tls: ca: my-ca cert: ${SECRETS}/%{monitor.hostname}.cert key: ${SECRETS}/%{monitor.hostname}.key meta: source: host2.local canary: no . ",
    "url": "http://localhost:4000/v1.0/config/quick-ref",
    "relUrl": "/v1.0/config/quick-ref"
  },"117": {
    "doc": "Quick Start",
    "title": "Quick Start",
    "content": " ",
    "url": "http://localhost:4000/v1.0/quick-start/",
    "relUrl": "/v1.0/quick-start/"
  },"118": {
    "doc": "Reporting",
    "title": "Reporting",
    "content": "Blip does not have a single format or protocol for reporting metrics. Instead, it has well-defined structures for collecting metrics that are passed to metric sinks, which convert and send metrics in various formats and protocols depending on the sink. In YAML, the basic structure of Blip metrics is: . domain: - metric: value: &lt;float64&gt; type: counter|gauge|... group: key1: val1 meta: key1: val1 . All metrics belong to a single domain. Each domain collector can collect any number of metrics. Each metric has a type and value (see Conventions &gt; Metrics). Groups and Meta are detailed below. A realistic example of two metrics from the status.global domain: . global.status: - threads_running: value: 16 type: gauge - queries: value: 138923 type: counter . The metric sink determines how those 2 metrics are reported. For example, a Prometheus sink might report them in Exposition format: . # TYPE mysql_global_status_threads_running gauge mysql_global_status_threads_running 16 # TYPE mysql_global_status_queries counter mysql_global_status_queries 138923 . Blip conventions terminate at each metric sink. ",
    "url": "http://localhost:4000/v1.0/metrics/reporting",
    "relUrl": "/v1.0/metrics/reporting"
  },"119": {
    "doc": "Reporting",
    "title": "Groups",
    "content": "Certain domains (as documented) implicitly or explicitly group metrics. In both cases, group key-value pairs are set for each metric, and metrics are uniquely identified using all group keys. Groups, labels, and dimensions serve the same purpose. Blip uses the term group because it’s similar to MySQL GROUP BY. Implicit grouping means the metrics collector groups metrics automatically (or as configured in the plan by collector options). For example, the size.data collector, which collects database and table sizes, groups metrics by database name. As a result, each metric has a group key on db, like the following example: . size.database: - bytes: value: 50920482048 type: gauge group: db: foo - bytes: value: 8920482048 type: gauge group: db: bar - bytes: value: 59840964096 type: gauge group: db: \"\" # all databases . The metric is the same—bytes—but there are 3 instances of the metric for each of the 3 groups: db=foo, db=bar, and db=\"\". The last group, db=\"\", is how this collector represents the metric for all databases (the global group). Explicit grouping refers to MySQL-grouped metrics—see Sub-domains. For example, the status.host collector is explicitly grouped by host. As a result, each metric has a group key on host, like host=10.1.1.1. ",
    "url": "http://localhost:4000/v1.0/metrics/reporting#groups",
    "relUrl": "/v1.0/metrics/reporting#groups"
  },"120": {
    "doc": "Reporting",
    "title": "Meta",
    "content": "Certain domains (as documented) set metadata about a metric. The canonical example is the response_time collector metric reported by the query.global collector: . query.global: - response_time: value: 130493 type: gauge meta: p95: p948 - response_time: value: 255001 type: gauge meta: p999: p997 . As shown above, there are 2 response_time metrics that differ by meta=p95 and meta=p999: the former is the 95th percentile response time, and the latter is the 99.9th percentile response time. Blip uses meta rather than prefixing or suffixing the metric name (see Conventions &gt; Metrics &gt; Naming). This makes metrics (by name) consistent: the metric is always response_time, not pN_response_time or response_time_pN where N could be any number. It also allows for a greater variety of metrics without special case exceptions to naming or structure; for example, average response time could be denoted by meta key avg. ",
    "url": "http://localhost:4000/v1.0/metrics/reporting#meta",
    "relUrl": "/v1.0/metrics/reporting#meta"
  },"121": {
    "doc": "retry",
    "title": "Retry Sink",
    "content": "sinks: retry: buffer-size: 60 send-timeout: 5s send-retry-wait: 200ms . Retry is a pseudo-sink that provides buffering, serialization, and retry for a real sink. The built-in sinks, except log, use Retry to handle those three complexities. Retry uses a LIFO queue (a stack) to prioritize sending the latest metrics. This means that, during a long outage of the real sink, Retry drops the oldest metrics and keeps the latest metrics, up to its buffer size, which is configurable. ",
    "url": "http://localhost:4000/v1.0/sinks/retry#retry-sink",
    "relUrl": "/v1.0/sinks/retry#retry-sink"
  },"122": {
    "doc": "retry",
    "title": "retry",
    "content": " ",
    "url": "http://localhost:4000/v1.0/sinks/retry",
    "relUrl": "/v1.0/sinks/retry"
  },"123": {
    "doc": "Scope",
    "title": "Scope",
    "content": "Plans have two scopes: . Shared . Shared plans are scoped to Blip and can be used by any monitor that references them. All plans configured in config.plans and the built-in plans plans are shared. This is the normal case: you define one or more plan (or none, using the built-in Blip plan), and all the monitors use those plans. Since interpolation works in plan files (see File &gt; Interpolation), shared plans can still be tailored to each monitor, if necessary (although it’s usually not necessary). Monitor . Monitor plans are scoped to one monitor and can only be used by that monitor. All plans configured in config.monitor.plans are monitor plans. See [config.plans] . ",
    "url": "http://localhost:4000/v1.0/plans/scope",
    "relUrl": "/v1.0/plans/scope"
  },"124": {
    "doc": "Scope",
    "title": "Built-in",
    "content": "Blip . Prometheus mysqld_exporter . ",
    "url": "http://localhost:4000/v1.0/plans/scope#built-in",
    "relUrl": "/v1.0/plans/scope#built-in"
  },"125": {
    "doc": "Server",
    "title": "Server",
    "content": " ",
    "url": "http://localhost:4000/v1.0/server/",
    "relUrl": "/v1.0/server/"
  },"126": {
    "doc": "Server",
    "title": "Server",
    "content": "Server endpoints return information about the blip instance (the server) and high-level information about monitors. | GET /status | GET /version | . ",
    "url": "http://localhost:4000/v1.0/api/server",
    "relUrl": "/v1.0/api/server"
  },"127": {
    "doc": "Server",
    "title": "GET /status",
    "content": "Returns high-level Blip server status. GET . /status . Response . { \"Started\" string // ISO timestamp (UTC) \"Uptime\" int64 // seconds \"MonitorCount\" uint // number of monitors loaded \"Internal\" map[string]string // Blip components \"Version\" string // Blip version } . Response Status Codes . 200: Successful operation. ",
    "url": "http://localhost:4000/v1.0/api/server#get-status",
    "relUrl": "/v1.0/api/server#get-status"
  },"128": {
    "doc": "Server",
    "title": "GET /version",
    "content": "Return Bip version. GET . /version . Response . v1.0.75 . Response Status Codes . 200: Successful operation. ",
    "url": "http://localhost:4000/v1.0/api/server#get-version",
    "relUrl": "/v1.0/api/server#get-version"
  },"129": {
    "doc": "signalfx",
    "title": "SignalFx Sink",
    "content": "sinks: signalfx: auth-token: \"\" auth-token-file: \"\" . Must provide auth-token or auth-token-file in config. Reports all tags as dimensions. Reports domain-qualified metric names: status.global.threads_running. ",
    "url": "http://localhost:4000/v1.0/sinks/signalfx#signalfx-sink",
    "relUrl": "/v1.0/sinks/signalfx#signalfx-sink"
  },"130": {
    "doc": "signalfx",
    "title": "signalfx",
    "content": " ",
    "url": "http://localhost:4000/v1.0/sinks/signalfx",
    "relUrl": "/v1.0/sinks/signalfx"
  },"131": {
    "doc": "Sinks",
    "title": "Sinks",
    "content": " ",
    "url": "http://localhost:4000/v1.0/sinks/",
    "relUrl": "/v1.0/sinks/"
  },"132": {
    "doc": "Sinks",
    "title": "Sinks",
    "content": "NOTE: You can skip this part of the introduction if: . | You use SignalFx, or | You use Chronosphere, or | You plan to use Blip to emulate and replace Prometheus `mysqld_exporter` | . Blip has built-in support for these three use cases. Blip ships with built-in and automatic support for almost everything, but the one thing we (the Blip developers) cannot know is where you (the user) will send metrics. Consequently, you might need to develop a Blip metric sink to translate and send Blip metrics to your metrics store or metrics graphing solution. Don’t worry: Bilp was intentially designed to make this easy. This brief introduction shows the high-level process of developing a new Blip metric sink. The following presumes that you’re an experienced Go programmer. All Blip sinks implement this interface: . type Sink interface { Send(context.Context, *Metrics) error Status() string } . Unsurprisingly, Blip calls the Send method to send metrics. The vast majority of work to implement a new sink is this one method. More on this in a moment. Blip calls the Status method to report real-time status of the sink (along with all other parts in the monitor). The reported status can be anything you think is useful to know; for exmaple, the last error sending metrics (if any). Let’s presume, for a moment, that you have implement a new sink. To allow Blip to make (instantiate) that sink, you implement one last interface: . type SinkFactory interface { Make(name, monitorId string, opts, tags map[string]string) (Sink, error) } . When a monitor uses your sink, Blip calls your sink factory to make a new sink for the monitor. Blip passes to your factory: . | Sink name (which is slightly redundant, but nobody is perfect) | Monitor ID (all monitors have a unique ID for status, logging, and so forth”) | Options (from the monitor config) | Tags (from the monitor config) | . Options are sink-specific options; for example, an API token is common for authenticating to hosted metrics soltuions. Tags describe the metrics; some metrics solutions calls these “dimensions”, others call them “labels”—Blip calls them “tags”. Options are tags are set in the monitor config, which you’ll learn more about later. Here’s a mock (incomplete and nonfunctional) implementation of a sink (called “Kim” for an engineer who left us [the Blip developers] to join a metrics solution startup) and sink factory, just to give you an idea: . import ( \"context\" \"github.com/cashapp/blip\" ) type Kim struct { tags map[string]string client Client // sink-specific client } func NewKim(monitorId string, opts, tags map[string]string) *Kim { return &amp;Kim{ tags: tags, client: NewClient(opts[\"addr\"], opts[\"api-token\"]), } } func (k *Kim) Send(cxt context.Context, metrics *blip.Metrics) error { // Metrics are grouped by/keyed on domain name for domain := range metrics { // Loop through metrics in each domain for i := range metrics[domain] { m := metrics[domain][i] // Name: m.Name (string) // Value: m.Value (float64) // Type: m.Type (const byte) // Transform Blip metrics to sink-specific struct/protocol } } // Send sink-specific struct/protocol (km) return k.client.Send(ctx, km) } func (k *Kim) Status() string { return \"I miss where I used to work\" } // -------------------------------------------------------------------------- type KimFactory struct{} func (f KimFactory) Make(name, monitorId string, opts, tags map[string]string) (blip.Sink, error) { k := NewKim(monitorId, opts, tags) return k, nil } . For real sinks, see the built-in Blip sinks: blip/sinks. Once your implementation is done, you register the sink with Blip: . sink.Register(\"kim\", KimFactory{}) . More on this later; for now, the point is that you register your sink with a given name (“kim”), and that name is important because it’s what you specify in a monitor config to make Blip instantiate the sink. Following is a snippet of a monitor config that shows how the “kim” sink is used and configured: . monitors: - id: host1 hostname: host1.local sinks: kim: addr: https://local.domain api-token: ABC123 tags: env: staging region: us-east-1 . On line 5, the “kim” sink is specified, and lines 6 and 7 are its options. Lines 9 and 10 are tags for the monitor, which are also passed to the sink when created. Keep learning: Monitors ↓ . ",
    "url": "http://localhost:4000/v1.0/intro/sinks",
    "relUrl": "/v1.0/intro/sinks"
  },"133": {
    "doc": "Table",
    "title": "Plan Table",
    "content": "CREATE TABLE plans ( name varchar(100) not null, levels blob not null monitor_id varchar(1000) null default null PRIMARY KEY (name), INDEX (monitorId) ) . -- Defalut single state plan (DSSP) (\"default\", \"{...}\", NULL) -- Default multi-state plans (\"readonly\", \"{...}\", NULL) (\"active\", \"{...}\", NULL) -- Per-moitor single state plans (\"mon1\", \"{...}\", \"mon1\") (\"mon2\", \"{...}\", \"mon2\") -- Mixed plans (\"default\", \"{...}\", NULL) (\"mon1-ro\", \"{...}\", \"mon1\") (\"mon1-rw\", \"{...}\", \"mon1\") (\"mon2\", \"{...}\", \"mon2\") -- mon3 uses default plan . ",
    "url": "http://localhost:4000/v1.0/plans/table#plan-table",
    "relUrl": "/v1.0/plans/table#plan-table"
  },"134": {
    "doc": "Table",
    "title": "Table",
    "content": " ",
    "url": "http://localhost:4000/v1.0/plans/table",
    "relUrl": "/v1.0/plans/table"
  }
}
