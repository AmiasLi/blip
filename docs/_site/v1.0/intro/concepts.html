<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <meta name="Description" content="Blip is the most advanced MySQL metrics collector ever built."> <title>Blip - Blip</title> <link rel="stylesheet" href="/blip/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/blip/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/blip/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/blip/" class="site-title lh-tight"> Blip </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/blip/" class="nav-list-link">Home</a></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/blip/v1.0/intro/" class="nav-list-link">Introduction</a><ul class="nav-list "><li class="nav-list-item active"><a href="/blip/v1.0/intro/concepts" class="nav-list-link active">Blip</a></li><li class="nav-list-item "><a href="/blip/v1.0/intro/monitors" class="nav-list-link">Monitors</a></li><li class="nav-list-item "><a href="/blip/v1.0/intro/plans" class="nav-list-link">Plans</a></li><li class="nav-list-item "><a href="/blip/v1.0/intro/sinks" class="nav-list-link">Sinks</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/blip/v1.0/quick-start/" class="nav-list-link">Quick Start</a><ul class="nav-list "><li class="nav-list-item "><a href="/blip/v1.0/quick-start/development" class="nav-list-link">Development</a></li><li class="nav-list-item "><a href="/blip/v1.0/quick-start/production" class="nav-list-link">Production</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/blip/v1.0/config/" class="nav-list-link">Configure</a><ul class="nav-list "><li class="nav-list-item "><a href="/blip/v1.0/config/blip" class="nav-list-link">Blip</a></li><li class="nav-list-item "><a href="/blip/v1.0/config/config-file" class="nav-list-link">Config File</a></li><li class="nav-list-item "><a href="/blip/v1.0/config/quick-ref" class="nav-list-link">Quick Reference</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/blip/v1.0/monitors/" class="nav-list-link">Monitors</a><ul class="nav-list "><li class="nav-list-item "><a href="/blip/v1.0/monitors/engine" class="nav-list-link">Engine</a></li><li class="nav-list-item "><a href="/blip/v1.0/monitors/error-handling" class="nav-list-link">Error Handling</a></li><li class="nav-list-item "><a href="/blip/v1.0/monitors/level-adjuster" class="nav-list-link">Level Plan Adjuster</a></li><li class="nav-list-item "><a href="/blip/v1.0/monitors/level-collector" class="nav-list-link">Level Plan Collector</a></li><li class="nav-list-item "><a href="/blip/v1.0/monitors/loading" class="nav-list-link">Loading</a></li><li class="nav-list-item "><a href="/blip/v1.0/monitors/mysql-connection" class="nav-list-link">MySQL Connection</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/blip/v1.0/plans/" class="nav-list-link">Plans</a><ul class="nav-list "><li class="nav-list-item "><a href="/blip/v1.0/plans/defaults" class="nav-list-link">Defaults</a></li><li class="nav-list-item "><a href="/blip/v1.0/plans/file" class="nav-list-link">File</a></li><li class="nav-list-item "><a href="/blip/v1.0/plans/table" class="nav-list-link">Table</a></li><li class="nav-list-item "><a href="/blip/v1.0/plans/scope" class="nav-list-link">Loading</a></li><li class="nav-list-item "><a href="/blip/v1.0/plans/error-policy" class="nav-list-link">Error Policy</a></li><li class="nav-list-item "><a href="/blip/v1.0/plans/quick-ref" class="nav-list-link">Quick Reference</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/blip/v1.0/metrics/" class="nav-list-link">Metrics</a><ul class="nav-list "><li class="nav-list-item "><a href="/blip/v1.0/metrics/defaults" class="nav-list-link">Defaults</a></li><li class="nav-list-item "><a href="/blip/v1.0/metrics/collecting" class="nav-list-link">Collecting</a></li><li class="nav-list-item "><a href="/blip/v1.0/metrics/reporting" class="nav-list-link">Reporting</a></li><li class="nav-list-item "><a href="/blip/v1.0/metrics/collectors" class="nav-list-link">Collectors</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/blip/v1.0/sinks/" class="nav-list-link">Sinks</a><ul class="nav-list "><li class="nav-list-item "><a href="/blip/v1.0/sinks/chronosphere" class="nav-list-link">chronosophere</a></li><li class="nav-list-item "><a href="/blip/v1.0/sinks/log" class="nav-list-link">log</a></li><li class="nav-list-item "><a href="/blip/v1.0/sinks/retry" class="nav-list-link">retry</a></li><li class="nav-list-item "><a href="/blip/v1.0/sinks/signalfx" class="nav-list-link">signalfx</a></li><li class="nav-list-item "><a href="/blip/v1.0/sinks/custom" class="nav-list-link">Custom</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/blip/v1.0/api/" class="nav-list-link">API</a><ul class="nav-list "><li class="nav-list-item "><a href="/blip/v1.0/api/server" class="nav-list-link">Server</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/blip/v1.0/cloud/" class="nav-list-link">Cloud</a><ul class="nav-list "><li class="nav-list-item "><a href="/blip/v1.0/cloud/aws" class="nav-list-link">AWS</a></li></ul></li><li class="nav-list-item"><a href="/blip/v1.0/heartbeat" class="nav-list-link">Heartbeat</a></li><li class="nav-list-item"><a href="/blip/v1.0/prometheus" class="nav-list-link">Prometheus</a></li><li class="nav-list-item"><a href="/blip/v1.0/integrate" class="nav-list-link">Integrate</a></li><li class="nav-list-item"><a href="/blip/release-notes" class="nav-list-link">Release Notes</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Blip" aria-label="Search Blip" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="//github.com/cashapp/blip" class="site-button" > Blip </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/blip/v1.0/intro/">Introduction</a></li> <li class="breadcrumb-nav-list-item"><span>Blip</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="blip"> <a href="#blip" class="anchor-heading" aria-labelledby="blip"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Blip </h1> <p>In the simplest setup, a single Blip instance monitors (collect metrics from) a single MySQL instance:</p> <p><img src="/blip/assets/img/blip-single.png" alt="Single Blip Instance" /></p> <p>But a single instance of Blip—a single running <code class="language-plaintext highlighter-rouge">blip</code> binary—can monitor any number of MySQL instances:</p> <p><img src="/blip/assets/img/blip-multi.png" alt="Multiple Blip Monitors" /></p> <p>In Blip lingo, a <em>monitor</em> collects metrics from a single instance of MySQL, as shown above. In short, “a monitor monitors MySQL.”</p> <p>Monitors are the central concept in Blip, so let’s zoom in on one monitor to see what makes it ticks:</p> <p><img src="/blip/assets/img/blip-monitor.png" alt="Blip Monitor Diagram" /></p> <p>A monitor has more parts than shown above, but the three most important parts are:</p> <dl> <dt><em>Sinks</em></dt> <dd>Sinks send metrics to a graphing system. A monitor can send metrics to more than one sink. Blip has built-in sinks for <a href="https://docs.signalfx.com/en/latest/">SignalFx</a> and <a href="https://chronosphere.io/">Chronosphere</a>, and it’s easy to write your own sink, which means Blip can send metrics anywhere.</dd> <dt><em>Plan</em></dt> <dd>A plan determines which metrics to collect. Blip has a default plan that collects more than 60 of the most important MySQL metrics. Plans can be customized, which means Blip can collect any MySQL metrics you need (or not collect metrics that you don’t need).</dd> <dt><em>Engine</em></dt> <dd>The engine does the real work: it collects metrics from MySQL according to a plan. You control the engine by customizing a plan (or just use the built-in default plan).</dd> </dl> <p>Let’s zoom in on the engine:</p> <p><img src="/blip/assets/img/blip-engine.png" alt="Blip Engine Diagram" /></p> <p>Inside the engine, another part called a <em>metrics collector</em> (or <em>collector</em> for short) collects metrics for one <em>domain</em>: a logical group of MySQL metrics. Above, the engine has <span style="color:magenta;">four collectors</span> that correspond to four domains:</p> <div class="table-wrapper"><table> <thead> <tr> <th>Domain</th> <th>Metrics</th> </tr> </thead> <tbody> <tr> <td>status.global</td> <td><code class="language-plaintext highlighter-rouge">SHOW GLOBAL STATUS</code></td> </tr> <tr> <td>var.global</td> <td><code class="language-plaintext highlighter-rouge">SHOW GLOBAL VARIABLES</code></td> </tr> <tr> <td>repl</td> <td><code class="language-plaintext highlighter-rouge">SHOW REPLICA STATUS</code>, …</td> </tr> <tr> <td>aws</td> <td>CloudWatch Metrics</td> </tr> </tbody> </table></div> <p>First, notice that a collector is not required required to collect metrics from MySQL. An AWS collector, for example, collects related MySQL metrics from Amazon CloudWatch. But most collectors collect metrics from various outputs of MySQL.</p> <p>Second, why a new abstraction—why “domains”? Because MySQL metrics are unorganized, and some metrics can be obtained from multiple outpus. For example, you can obtain the global system variable <code class="language-plaintext highlighter-rouge">max_connections</code> from three different outputs (or commands):</p> <ul> <li><code class="language-plaintext highlighter-rouge">SHOW GLOBAL VARIABLES LIKE 'max_connections';</code></li> <li><code class="language-plaintext highlighter-rouge">SELECT @@GLOBAL.max_connections;</code></li> <li><code class="language-plaintext highlighter-rouge">SELECT * FROM global_variables WHERE variable_name='max_connections';</code></li> </ul> <p>That’s a trivial exmaple. Metric domains become important—practically necessary—when you account for the MySQL <a href="https://dev.mysql.com/doc/refman/8.0/en/performance-schema">Performance Schema</a> (and sometimes the MySQL <a href="https://dev.mysql.com/doc/refman/8.0/en/sys-schema">sys Schema</a>), various command and output changes from MySQL 5.6 to 5.7 to 8.0, subtle differences between distributions (Oracle vs. Percona vs. MariaDB), and cloud providers (like Amazon RDS). Metric domains simplify <em>how</em> metrics are collected. As a user, you shouldn’t care how metrics are collected; you should only care <em>which</em> metrics are collected. Domains and plans make that possible.</p> <p>A <em>level plan</em> (or <em>plan</em> for short) configures which metrics to collect—by domain. Here’s a snippet of a plan that collects two metrics every 5 seconds:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">key-perf-indicators</span><span class="pi">:</span>
  <span class="na">freq</span><span class="pi">:</span> <span class="s">5s</span>
  <span class="na">collect</span><span class="pi">:</span>
    <span class="s">status.global</span><span class="pi">:</span>
      <span class="na">metrics</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">Queries</span>
        <span class="pi">-</span> <span class="s">Threads_running</span>
</code></pre></div></div> <p>Plans specify at least one <em>level</em>: a named group of metrics collected at a unique frequency. In this example, the level name is <code class="language-plaintext highlighter-rouge">key-perf-indicators</code>, and its frequency (<code class="language-plaintext highlighter-rouge">freq: 5s</code>) is every 5 seconds: 5s, 10s, 15s, and so forth. It collects two metrics from the <code class="language-plaintext highlighter-rouge">status.global</code> domain: <code class="language-plaintext highlighter-rouge">Queries</code> and <code class="language-plaintext highlighter-rouge">Threads_running</code>.</p> <p>Real plans have several levels and tens (or hundreds) of metrics from various domains. For example, the built-in default plan has four levels and collects over 60 metrics. But here’s a simpler example with two levels:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">key-perf-indicators</span><span class="pi">:</span>
  <span class="na">freq</span><span class="pi">:</span> <span class="s">5s</span>
  <span class="na">collect</span><span class="pi">:</span>
    <span class="s">status.global</span><span class="pi">:</span>
      <span class="na">metrics</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">Queries</span>
        <span class="pi">-</span> <span class="s">Threads_running</span>
<span class="na">database-sizes</span><span class="pi">:</span>
  <span class="na">freq</span><span class="pi">:</span> <span class="s">60s</span>
  <span class="na">collect</span><span class="pi">:</span>
    <span class="s">size.database</span><span class="pi">:</span>
      <span class="na">options</span><span class="pi">:</span>
        <span class="na">exclude</span><span class="pi">:</span> <span class="s">test_db,dba_stuff</span>
      <span class="na">metrics</span><span class="pi">:</span>
        <span class="c1"># Automatic</span>
</code></pre></div></div> <p>Now the plan has two levels: the original <code class="language-plaintext highlighter-rouge">key-perf-indicators</code> plus <code class="language-plaintext highlighter-rouge">database-sizes</code> every 60 seconds. Blip combines levels automatically: at 55 seconds, it collects only <code class="language-plaintext highlighter-rouge">key-perf-indicators</code> metrics; but at 60 seconds, it collects <code class="language-plaintext highlighter-rouge">key-perf-indicators</code> metrics <em>and</em> <code class="language-plaintext highlighter-rouge">database-sizes</code> metrics. In technical terms, Blip collects every level where <code class="language-plaintext highlighter-rouge">freq % T == 0</code>, where <code class="language-plaintext highlighter-rouge">T</code> is the number of seconds elapsed since the monitor started.</p> <p class="note"> You don't have to write a plan to use Blip because it has a built-in plan that collects the most common and important MySQL metrics, including meta-metrics like database sizes. Writing your own plan allows you to customize which metrics to collect and when (how frequently). </p> <p>Plans and levels allow you to collect different metrics at different frequencies. For example, you can collect and report key performance indicators every 5 seconds, but collect and report table sizes every 60s. This is more efficient and cost-effective, especially if you use a hosted metrics graphing solution.</p> <p>When the engine is done collecting metrics for a level, the monitor sends the metrics to one or more metric sink configured for the monitor. A <em>sink</em> is a plugin that accepts a Blip metrics data structure, then translates and sends the metrics somewhere. A sink can also rename metrics, add labels/dimensions/tags, and so forth—whatever is appropriate for the sink destination. Blip has built-in sinks for <a href="https://docs.signalfx.com/en/latest/">SignalFx</a> and <a href="https://chronosphere.io/">Chronosphere</a>, but since the sink is a plugin, it’s trivial to write new sinks to support new destinations.</p><hr /> <p>Keep learning: <a href="monitors">Monitors ↓</a></p> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
