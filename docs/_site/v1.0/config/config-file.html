<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <meta name="Description" content="Blip is the most advanced MySQL metrics collector ever built."> <title>Config File - Blip</title> <link rel="stylesheet" href="/blip/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/blip/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/blip/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/blip/" class="site-title lh-tight"> Blip </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/blip/" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/blip/v1.0/intro/" class="nav-list-link">Introduction</a><ul class="nav-list "><li class="nav-list-item "><a href="/blip/v1.0/intro/concepts" class="nav-list-link">Blip</a></li><li class="nav-list-item "><a href="/blip/v1.0/intro/sinks" class="nav-list-link">Sinks</a></li><li class="nav-list-item "><a href="/blip/v1.0/intro/monitors" class="nav-list-link">Monitors</a></li><li class="nav-list-item "><a href="/blip/v1.0/intro/plans" class="nav-list-link">Plans</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/blip/v1.0/quick-start/" class="nav-list-link">Quick Start</a><ul class="nav-list "><li class="nav-list-item "><a href="/blip/v1.0/quick-start/laptop" class="nav-list-link">Laptop</a></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/blip/v1.0/config/" class="nav-list-link">Configure</a><ul class="nav-list "><li class="nav-list-item "><a href="/blip/v1.0/config/blip" class="nav-list-link">Blip</a></li><li class="nav-list-item active"><a href="/blip/v1.0/config/config-file" class="nav-list-link active">Config File</a></li><li class="nav-list-item "><a href="/blip/v1.0/config/quick-ref" class="nav-list-link">Quick Reference</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/blip/v1.0/plans/" class="nav-list-link">Plans</a><ul class="nav-list "><li class="nav-list-item "><a href="/blip/v1.0/plans/defaults" class="nav-list-link">Defaults</a></li><li class="nav-list-item "><a href="/blip/v1.0/plans/file" class="nav-list-link">File</a></li><li class="nav-list-item "><a href="/blip/v1.0/plans/table" class="nav-list-link">Table</a></li><li class="nav-list-item "><a href="/blip/v1.0/plans/scope" class="nav-list-link">Scope</a></li><li class="nav-list-item "><a href="/blip/v1.0/plans/quick-ref" class="nav-list-link">Quick Reference</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/blip/v1.0/metrics/" class="nav-list-link">Metrics</a><ul class="nav-list "><li class="nav-list-item "><a href="/blip/v1.0/metrics/defaults" class="nav-list-link">Defaults</a></li><li class="nav-list-item "><a href="/blip/v1.0/metrics/conventions" class="nav-list-link">Conventions</a></li><li class="nav-list-item "><a href="/blip/v1.0/metrics/reporting" class="nav-list-link">Reporting</a></li><li class="nav-list-item "><a href="/blip/v1.0/metrics/domains" class="nav-list-link">Domains</a></li><li class="nav-list-item "><a href="/blip/v1.0/metrics/collectors" class="nav-list-link">Collectors</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/blip/v1.0/sinks/" class="nav-list-link">Sinks</a><ul class="nav-list "><li class="nav-list-item "><a href="/blip/v1.0/sinks/chronosphere" class="nav-list-link">chronosophere</a></li><li class="nav-list-item "><a href="/blip/v1.0/sinks/log" class="nav-list-link">log</a></li><li class="nav-list-item "><a href="/blip/v1.0/sinks/retry" class="nav-list-link">retry</a></li><li class="nav-list-item "><a href="/blip/v1.0/sinks/signalfx" class="nav-list-link">signalfx</a></li><li class="nav-list-item "><a href="/blip/v1.0/sinks/custom" class="nav-list-link">Custom</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/blip/v1.0/api/" class="nav-list-link">API</a><ul class="nav-list "><li class="nav-list-item "><a href="/blip/v1.0/api/server" class="nav-list-link">Server</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/blip/v1.0/cloud/" class="nav-list-link">Cloud</a><ul class="nav-list "><li class="nav-list-item "><a href="/blip/v1.0/cloud/aws" class="nav-list-link">AWS</a></li></ul></li><li class="nav-list-item"><a href="/blip/v1.0/heartbeat" class="nav-list-link">Heartbeat</a></li><li class="nav-list-item"><a href="/blip/v1.0/prometheus" class="nav-list-link">Prometheus</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/blip/v1.0/monitor/" class="nav-list-link">Monitor</a><ul class="nav-list "><li class="nav-list-item "><a href="/blip/v1.0/monitor/engine" class="nav-list-link">Engine</a></li><li class="nav-list-item "><a href="/blip/v1.0/monitor/level-adjuster" class="nav-list-link">Level Plan Adjuster</a></li><li class="nav-list-item "><a href="/blip/v1.0/monitor/level-collector" class="nav-list-link">Level Plan Collector</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/blip/v1.0/server/" class="nav-list-link">Server</a><ul class="nav-list "><li class="nav-list-item "><a href="/blip/v1.0/server/core" class="nav-list-link">Blip</a></li><li class="nav-list-item "><a href="/blip/v1.0/server/plan-loader" class="nav-list-link">Plan Loader</a></li><li class="nav-list-item "><a href="/blip/v1.0/server/monitor-loader" class="nav-list-link">Monitor Loader</a></li><li class="nav-list-item "><a href="/blip/v1.0/server/db-maker" class="nav-list-link">Db Maker</a></li></ul></li><li class="nav-list-item"><a href="/blip/v1.0/integrate" class="nav-list-link">Integrate</a></li><li class="nav-list-item"><a href="/blip/release-notes" class="nav-list-link">Release Notes</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Blip" aria-label="Search Blip" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="//github.com/cashapp/blip" class="site-button" > Blip </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/blip/v1.0/config/">Configure</a></li> <li class="breadcrumb-nav-list-item"><span>Config File</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <ul class="floating-toc" id="markdown-toc"> <li><a href="#config-file" id="markdown-toc-config-file">Config File</a></li> <li><a href="#conventions" id="markdown-toc-conventions">Conventions</a></li> <li><a href="#interpolation" id="markdown-toc-interpolation">Interpolation</a></li> <li><a href="#server-config" id="markdown-toc-server-config">Server Config</a> <ul> <li><a href="#api" id="markdown-toc-api">api</a> <ul> <li><a href="#bind" id="markdown-toc-bind"><code class="language-plaintext highlighter-rouge">bind</code></a></li> <li><a href="#disable" id="markdown-toc-disable"><code class="language-plaintext highlighter-rouge">disable</code></a></li> </ul> </li> <li><a href="#monitor-loader" id="markdown-toc-monitor-loader">monitor-loader</a> <ul> <li><a href="#aws" id="markdown-toc-aws">aws</a></li> <li><a href="#regions" id="markdown-toc-regions"><code class="language-plaintext highlighter-rouge">regions</code></a></li> <li><a href="#freq" id="markdown-toc-freq"><code class="language-plaintext highlighter-rouge">freq</code></a></li> <li><a href="#files" id="markdown-toc-files"><code class="language-plaintext highlighter-rouge">files</code></a></li> <li><a href="#local" id="markdown-toc-local">local</a></li> <li><a href="#stop-loss" id="markdown-toc-stop-loss"><code class="language-plaintext highlighter-rouge">stop-loss</code></a></li> </ul> </li> <li><a href="#strict" id="markdown-toc-strict"><code class="language-plaintext highlighter-rouge">strict</code></a></li> </ul> </li> <li><a href="#monitor-defaults" id="markdown-toc-monitor-defaults">Monitor Defaults</a> <ul> <li><a href="#aws-1" id="markdown-toc-aws-1">aws</a> <ul> <li><a href="#disable-auto-region" id="markdown-toc-disable-auto-region"><code class="language-plaintext highlighter-rouge">disable-auto-region</code></a></li> <li><a href="#disable-auto-tls" id="markdown-toc-disable-auto-tls"><code class="language-plaintext highlighter-rouge">disable-auto-tls</code></a></li> <li><a href="#iam-auth-token" id="markdown-toc-iam-auth-token"><code class="language-plaintext highlighter-rouge">iam-auth-token</code></a></li> <li><a href="#password-secret" id="markdown-toc-password-secret"><code class="language-plaintext highlighter-rouge">password-secret</code></a></li> <li><a href="#region" id="markdown-toc-region"><code class="language-plaintext highlighter-rouge">region</code></a></li> </ul> </li> <li><a href="#exporter" id="markdown-toc-exporter">exporter</a> <ul> <li><a href="#flags" id="markdown-toc-flags"><code class="language-plaintext highlighter-rouge">flags</code></a></li> <li><a href="#mode" id="markdown-toc-mode"><code class="language-plaintext highlighter-rouge">mode</code></a></li> </ul> </li> <li><a href="#heartbeat" id="markdown-toc-heartbeat">heartbeat</a> <ul> <li><a href="#freq-1" id="markdown-toc-freq-1"><code class="language-plaintext highlighter-rouge">freq</code></a></li> <li><a href="#table" id="markdown-toc-table"><code class="language-plaintext highlighter-rouge">table</code></a></li> </ul> </li> <li><a href="#mysql" id="markdown-toc-mysql">mysql</a> <ul> <li><a href="#hostname" id="markdown-toc-hostname"><code class="language-plaintext highlighter-rouge">hostname</code></a></li> <li><a href="#mycnf" id="markdown-toc-mycnf"><code class="language-plaintext highlighter-rouge">mycnf</code></a></li> <li><a href="#username" id="markdown-toc-username"><code class="language-plaintext highlighter-rouge">username</code></a></li> <li><a href="#password" id="markdown-toc-password"><code class="language-plaintext highlighter-rouge">password</code></a></li> <li><a href="#password-file" id="markdown-toc-password-file"><code class="language-plaintext highlighter-rouge">password-file</code></a></li> <li><a href="#socket" id="markdown-toc-socket"><code class="language-plaintext highlighter-rouge">socket</code></a></li> <li><a href="#timeout-connect" id="markdown-toc-timeout-connect"><code class="language-plaintext highlighter-rouge">timeout-connect</code></a></li> </ul> </li> <li><a href="#plans" id="markdown-toc-plans">plans</a> <ul> <li><a href="#adjust" id="markdown-toc-adjust">adjust</a> <ul> <li><a href="#after" id="markdown-toc-after"><code class="language-plaintext highlighter-rouge">after</code></a></li> <li><a href="#plan" id="markdown-toc-plan"><code class="language-plaintext highlighter-rouge">plan</code></a></li> </ul> </li> <li><a href="#files-1" id="markdown-toc-files-1"><code class="language-plaintext highlighter-rouge">files</code></a></li> <li><a href="#monitor" id="markdown-toc-monitor"><code class="language-plaintext highlighter-rouge">monitor</code></a></li> <li><a href="#table-1" id="markdown-toc-table-1"><code class="language-plaintext highlighter-rouge">table</code></a></li> </ul> </li> <li><a href="#sinks" id="markdown-toc-sinks">sinks</a> <ul> <li><a href="#chronosphere" id="markdown-toc-chronosphere">chronosphere</a></li> <li><a href="#log" id="markdown-toc-log">log</a></li> <li><a href="#noop" id="markdown-toc-noop">noop</a></li> <li><a href="#signalfix" id="markdown-toc-signalfix">signalfix</a></li> </ul> </li> <li><a href="#tags" id="markdown-toc-tags">tags</a></li> <li><a href="#tls" id="markdown-toc-tls">tls</a> <ul> <li><a href="#ca" id="markdown-toc-ca"><code class="language-plaintext highlighter-rouge">ca</code></a></li> <li><a href="#cert" id="markdown-toc-cert"><code class="language-plaintext highlighter-rouge">cert</code></a></li> <li><a href="#key" id="markdown-toc-key"><code class="language-plaintext highlighter-rouge">key</code></a></li> </ul> </li> </ul> </li> <li><a href="#monitors" id="markdown-toc-monitors">Monitors</a> <ul> <li><a href="#id" id="markdown-toc-id"><code class="language-plaintext highlighter-rouge">id</code></a></li> <li><a href="#meta" id="markdown-toc-meta"><code class="language-plaintext highlighter-rouge">meta</code></a></li> </ul> </li> </ul> <h1 id="config-file"> <a href="#config-file" class="anchor-heading" aria-labelledby="config-file"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Config File </h1> <p>Blip configuration is specified in a single YAML file (see <a href="blip#specifying-a-config-file">Specifying a Config File</a>). Concetpually, the Blip config file has three parts as shown and defined below.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="c1"># Server config</span>

<span class="c1"># Monitor defaults</span>

<span class="c1"># Monitors</span>
<span class="na">monitors</span><span class="pi">:</span> <span class="pi">[]</span>
</code></pre></div></div> <dl> <dt><em>Server config</em></dt> <dd>Top-level sections that configure the <code class="language-plaintext highlighter-rouge">blip</code> instance, which is called the “server”: API, monitor loading, and so forth</dd> <dt><em>Monitor defaults</em></dt> <dd>Top-level sections that provide default values for each monitor: hostname, username, and so on</dd> <dt><em>Monitors</em></dt> <dd>List items under the <code class="language-plaintext highlighter-rouge">monitors</code> section, one for each MySQL instance to monitor: hostname, username, and so on</dd> </dl> <p>A simple Blip config file for monitoring a single MySQL instance looks like:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">monitors</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">hostname</span><span class="pi">:</span> <span class="s">db.local</span>
    <span class="na">username</span><span class="pi">:</span> <span class="s">metrics</span>
    <span class="na">password</span><span class="pi">:</span> <span class="s2">"</span><span class="s">myVerySecurePassword"</span>
</code></pre></div></div> <p>Since no server config is specified, <code class="language-plaintext highlighter-rouge">blip</code> uses built-in defaults (see <a href="blip#zero-config">Zero Config</a>), which is probably fine for the server.</p> <p class="src">// <a href="https://github.com/cashapp/blip/blob/main/config.go">config.go</a></p> <h1 id="conventions"> <a href="#conventions" class="anchor-heading" aria-labelledby="conventions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Conventions </h1> <p>To reference sections, subsections, and specific user-configurable variables within those sections:</p> <dl> <dt><code class="language-plaintext highlighter-rouge">SECTION</code></dt> <dd>Any top-level section. For example: <code class="language-plaintext highlighter-rouge">api</code>, <code class="language-plaintext highlighter-rouge">plans</code>, and <code class="language-plaintext highlighter-rouge">monitors</code>.</dd> <dt><code class="language-plaintext highlighter-rouge">SECTION[.SUB...].VAR</code></dt> <dd>A user-configurable variable in the <code class="language-plaintext highlighter-rouge">SECTION</code> with optional subections (<code class="language-plaintext highlighter-rouge">SUB</code>). For example: <code class="language-plaintext highlighter-rouge">mysql.username</code> (section = <code class="language-plaintext highlighter-rouge">mysql</code>, variable = <code class="language-plaintext highlighter-rouge">username</code>), or <code class="language-plaintext highlighter-rouge">monitors.heartbeat.freq</code> (section = ‘monitors’, subsection = ‘heartbeat’, variable = ‘freq`).</dd> </dl> <p>Note the difference between <code class="language-plaintext highlighter-rouge">heartbeat</code> and <code class="language-plaintext highlighter-rouge">monitors.heartbeat</code>: the former is the top-level <a href="#monitor-defaults">monitor default</a>; the latter is a <a href="#monitors">monitor config</a> that inherts the monitor defaults, if any.</p> <p>Outside this section of the docs, we prefix all config references with <code class="language-plaintext highlighter-rouge">config.</code>. For example, elsewhere in the docs, we write <code class="language-plaintext highlighter-rouge">config.api</code> to make it clear that we’re refering to the <code class="language-plaintext highlighter-rouge">api</code> section of the Blip config file.</p> <p>All section and variable names are <code class="language-plaintext highlighter-rouge">lowercase-and-hyphenated</code>. (But string values that you specifiy can by anything you want.)</p> <p><code class="language-plaintext highlighter-rouge">disable</code> and <code class="language-plaintext highlighter-rouge">disable-auto-...</code> are used to disable features. There are no “enable” prefixes or variables. Instead, some features of either off or auto by default. If off by default, the feature is enabled by specifying a variable noted in the docs. For example, <code class="language-plaintext highlighter-rouge">heartbeat</code> is off by default and enabled when <code class="language-plaintext highlighter-rouge">heartbeat.freq</code> is specififed. If auto by default, the feature is disabled by specifying <code class="language-plaintext highlighter-rouge">disable-auto-FEATURE: true</code>, where <code class="language-plaintext highlighter-rouge">FEATURE</code> is the feature name. For example, <code class="language-plaintext highlighter-rouge">aws.disable-auto-region: true</code> to disable auto-detecting the AWS region.</p> <p><br /><br /><br /></p> <h1 id="interpolation"> <a href="#interpolation" class="anchor-heading" aria-labelledby="interpolation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Interpolation </h1> <p>Blip automatically interploates environment variables and monitor variables in the config file <em>and</em> plans.</p> <dl> <dt>Environment variable</dt> <dd><code class="language-plaintext highlighter-rouge">${FOO}</code></dd> <dt>Environment variable with default value</dt> <dd><code class="language-plaintext highlighter-rouge">${FOO:-default}</code></dd> <dt>Monitor variable</dt> <dd><code class="language-plaintext highlighter-rouge">%{monitor.VAR}</code></dd> </dl> <p class="note"><strong>NOTE</strong>: <code class="language-plaintext highlighter-rouge">${}</code> and <code class="language-plaintext highlighter-rouge">%{}</code> are always required.</p> <p>Environment variable interpolation is a simple implementation of the shell standard. In Blip, only the two cases shown above are supported, and <code class="language-plaintext highlighter-rouge">default</code> must be a literal value (it cannot be another <code class="language-plaintext highlighter-rouge">${}</code>).</p> <p>Monitor variables are scoped to (only work within) a single monitor. For example:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">monitors</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">hostname</span><span class="pi">:</span> <span class="s">db.local</span>
    <span class="na">username</span><span class="pi">:</span> <span class="s">metrics</span>
    <span class="na">tags</span><span class="pi">:</span>
      <span class="na">hostname</span><span class="pi">:</span> <span class="err">%</span><span class="pi">{</span><span class="nv">monitor.hostname</span><span class="pi">}</span>
</code></pre></div></div> <p>The result is <code class="language-plaintext highlighter-rouge">monitors.tags.hostname = "db.local"</code> because <code class="language-plaintext highlighter-rouge">%{monitor.hostname}</code> refers to the local <code class="language-plaintext highlighter-rouge">monitors.hostname</code> variable. Blip is remarkably flexible, so this works the other way, too:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">monitors</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">hostname</span><span class="pi">:</span> <span class="err">%</span><span class="pi">{</span><span class="nv">monitor.tags.hostname</span><span class="pi">}</span>
    <span class="na">username</span><span class="pi">:</span> <span class="s">metrics</span>
    <span class="na">tags</span><span class="pi">:</span>
      <span class="na">hostname</span><span class="pi">:</span> <span class="s">db.local</span>
</code></pre></div></div> <p>The result is <code class="language-plaintext highlighter-rouge">monitors.hostname = "db.local"</code> because <code class="language-plaintext highlighter-rouge">%{monitor.tags.hostname}</code> refers to the local <code class="language-plaintext highlighter-rouge">monitrs.tags.hostname</code> variable.</p> <p class="note">Singular “monitor” in <code class="language-plaintext highlighter-rouge">%{monitor.VAR}</code>, not plural, to emphasize that the reference is only to the single monitor in which it appears</p> <p><code class="language-plaintext highlighter-rouge">%{monitor.VAR}</code> references outside <a href="#monitors">monitors</a> or <a href="#monitor-defaults">monitor defaults</a> are ignored and reuslt in the literal string: “%{monitor.VAR}”.</p> <p>You can use both in a single value, like:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">tls</span><span class="pi">:</span>
  <span class="na">ca</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${SECRETS_DIR}/%{monitor.hostname}"</span>

<span class="na">monitors</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">hostname</span><span class="pi">:</span> <span class="s">db1</span>
  <span class="pi">-</span> <span class="na">hostname</span><span class="pi">:</span> <span class="s">db2</span>
</code></pre></div></div> <p>Top-level <code class="language-plaintext highlighter-rouge">tls.ca</code> specifies a monitor default that applies to all monitors that don’t explicily set the varaible. If <code class="language-plaintext highlighter-rouge">SECRETS_DIR = /secrets</code>, the result is:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">monitors</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">hostname</span><span class="pi">:</span> <span class="s">db1</span>
    <span class="na">tls</span><span class="pi">:</span>
      <span class="na">ca</span><span class="pi">:</span> <span class="s">/secrets/db1</span>
  <span class="pi">-</span> <span class="na">hostname</span><span class="pi">:</span> <span class="s">db2</span>
    <span class="na">tls</span><span class="pi">:</span>
      <span class="na">ca</span><span class="pi">:</span> <span class="s">/secrets/db2</span>
</code></pre></div></div> <h1 id="server-config"> <a href="#server-config" class="anchor-heading" aria-labelledby="server-config"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Server Config </h1> <h2 class="config-section-title" id="api"> <a href="#api" class="anchor-heading" aria-labelledby="api"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> api </h2> <p>The <code class="language-plaintext highlighter-rouge">api</code> section configures the <a href="../api/">Blip API</a>.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">api</span><span class="pi">:</span>
  <span class="na">bind</span><span class="pi">:</span> <span class="s2">"</span><span class="s">127.0.0.1:9070"</span>
  <span class="na">disable</span><span class="pi">:</span> <span class="no">false</span>
</code></pre></div></div> <h3 id="bind"> <a href="#bind" class="anchor-heading" aria-labelledby="bind"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">bind</code> </h3> <div class="table-wrapper"><table class="var-table"> <tbody> <tr> <td><strong>Type</strong></td> <td>string</td> </tr> <tr> <td><strong>Valid values</strong></td> <td><code class="language-plaintext highlighter-rouge">addr:port</code>, <code class="language-plaintext highlighter-rouge">:port</code></td> </tr> <tr> <td><strong>Default value</strong></td> <td><code class="language-plaintext highlighter-rouge">127.0.0.1:9070</code></td> </tr> </tbody> </table></div> <p>The <code class="language-plaintext highlighter-rouge">bind</code> variable sets the interface address and port that the API listens on.</p> <h3 id="disable"> <a href="#disable" class="anchor-heading" aria-labelledby="disable"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">disable</code> </h3> <div class="table-wrapper"><table class="var-table"> <tbody> <tr> <td><strong>Type</strong></td> <td>bool</td> </tr> <tr> <td><strong>Valid values</strong></td> <td><code class="language-plaintext highlighter-rouge">true</code>, <code class="language-plaintext highlighter-rouge">false</code></td> </tr> <tr> <td><strong>Default value</strong></td> <td><code class="language-plaintext highlighter-rouge">false</code></td> </tr> </tbody> </table></div> <p>The <code class="language-plaintext highlighter-rouge">disable</code> variable disables the Blip API.</p> <h2 class="config-section-title" id="monitor-loader"> <a href="#monitor-loader" class="anchor-heading" aria-labelledby="monitor-loader"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> monitor-loader </h2> <p>The <code class="language-plaintext highlighter-rouge">monitor-loader</code> section configures how Blip finds and loads MySQL instances.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">monitor-loader</span><span class="pi">:</span>
  <span class="na">aws</span><span class="pi">:</span>
    <span class="na">regions</span><span class="pi">:</span> <span class="pi">[]</span>
  <span class="na">freq</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
  <span class="na">files</span><span class="pi">:</span> <span class="pi">[]</span>
  <span class="na">local</span><span class="pi">:</span>
    <span class="na">disable-auto</span><span class="pi">:</span> <span class="no">false</span>
    <span class="na">disable-auto-root</span><span class="pi">:</span> <span class="no">false</span>
  <span class="na">stop-loss</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
</code></pre></div></div> <h3 id="aws"> <a href="#aws" class="anchor-heading" aria-labelledby="aws"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> aws </h3> <p>The <code class="language-plaintext highlighter-rouge">aws</code> subsection of the <code class="language-plaintext highlighter-rouge">monitor-loader</code> section configure built-in support for loading Amazon RDS instances. By default, this feature is disabled. To enable, specify <code class="language-plaintext highlighter-rouge">regions</code>.</p> <h3 id="regions"> <a href="#regions" class="anchor-heading" aria-labelledby="regions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">regions</code> </h3> <div class="table-wrapper"><table class="var-table"> <tbody> <tr> <td><strong>Type</strong></td> <td>list of strings</td> </tr> <tr> <td><strong>Valid values</strong></td> <td>AWS region names or “auto” to auto-detect</td> </tr> <tr> <td><strong>Default value</strong></td> <td> </td> </tr> </tbody> </table></div> <p>The <code class="language-plaintext highlighter-rouge">regions</code> variable sets which AWS regions to query for RDS instances. If <code class="language-plaintext highlighter-rouge">auto</code> is specified, Blip queries <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html">EC2 IMDS</a>, which only works if Blip is running on an EC2 instance with an <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-ec2_instance-profiles.html">EC2 instance profile</a> that allows <a href="https://docs.aws.amazon.com/AmazonRDS/latest/APIReference/API_DescribeDBInstances.html">rds:DescribeDBInstances</a>.</p> <h3 id="freq"> <a href="#freq" class="anchor-heading" aria-labelledby="freq"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">freq</code> </h3> <div class="table-wrapper"><table class="var-table"> <tbody> <tr> <td><strong>Type</strong></td> <td>string</td> </tr> <tr> <td><strong>Valid values</strong></td> <td><a href="https://pkg.go.dev/time#ParseDuration">Go duration string</a></td> </tr> <tr> <td><strong>Default value</strong></td> <td> </td> </tr> </tbody> </table></div> <p>The <code class="language-plaintext highlighter-rouge">freq</code> variable enables automatic monitor reloading. It’s off by default, which means moniitors are loaded only once at startup.</p> <h3 id="files"> <a href="#files" class="anchor-heading" aria-labelledby="files"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">files</code> </h3> <div class="table-wrapper"><table class="var-table"> <tbody> <tr> <td><strong>Type</strong></td> <td>list of strings</td> </tr> <tr> <td><strong>Valid values</strong></td> <td>file names</td> </tr> <tr> <td><strong>Default value</strong></td> <td> </td> </tr> </tbody> </table></div> <p>The <code class="language-plaintext highlighter-rouge">files</code> variable specifies YAML files to load monitors from. Each file must have a <code class="language-plaintext highlighter-rouge">monitors</code> section, like:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="na">monitors</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">hostname</span><span class="pi">:</span> <span class="s">db.local</span>
</code></pre></div></div> <h3 id="local"> <a href="#local" class="anchor-heading" aria-labelledby="local"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> local </h3> <p>The <code class="language-plaintext highlighter-rouge">local</code> subsection has only two variables:</p> <p><code class="language-plaintext highlighter-rouge">disable-auto: true</code> <code class="language-plaintext highlighter-rouge">disable-auto-root: true</code></p> <h3 id="stop-loss"> <a href="#stop-loss" class="anchor-heading" aria-labelledby="stop-loss"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">stop-loss</code> </h3> <div class="table-wrapper"><table class="var-table"> <tbody> <tr> <td><strong>Type</strong></td> <td>string</td> </tr> <tr> <td><strong>Valid values</strong></td> <td>• “N%” (percentage) where N is an integer between 0 and 100 (exclusive)<br />• “N” where N is an integer greater than 0</td> </tr> <tr> <td><strong>Default value</strong></td> <td> </td> </tr> </tbody> </table></div> <p>The <code class="language-plaintext highlighter-rouge">stop-loss</code> variable enables the <a href="../server/monitor-loader#stop-loss">stop-lost feature</a>.</p> <h2 id="strict"> <a href="#strict" class="anchor-heading" aria-labelledby="strict"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">strict</code> </h2> <div class="table-wrapper"><table class="var-table"> <tbody> <tr> <td><strong>Type</strong></td> <td>bool</td> </tr> <tr> <td><strong>Valid values</strong></td> <td><code class="language-plaintext highlighter-rouge">true</code>, <code class="language-plaintext highlighter-rouge">false</code></td> </tr> <tr> <td><strong>Default value</strong></td> <td><code class="language-plaintext highlighter-rouge">false</code></td> </tr> </tbody> </table></div> <p>The <code class="language-plaintext highlighter-rouge">strict</code> variable enables strict mode, which is disabled by default. In strict mode, Blip returns certain errors rather than ignoring them.</p> <h1 id="monitor-defaults"> <a href="#monitor-defaults" class="anchor-heading" aria-labelledby="monitor-defaults"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Monitor Defaults </h1> <p>Monitor defaults are top-level sections that set default values for monitors that do not set an explicit value. Monitor defaults are useful when you have several MySQL instances to monitor and the configuration only differs by basic connection parameters, like hostname or socket.</p> <p>For example, imagine that you have 10 monitors all with the same username and password. Instead of setting <code class="language-plaintext highlighter-rouge">username</code> and <code class="language-plaintext highlighter-rouge">password</code> in all 10 monitors, you can set these variables once in the top-level <code class="language-plaintext highlighter-rouge">mysql</code> section:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">mysql</span><span class="pi">:</span>
  <span class="na">username</span><span class="pi">:</span> <span class="s2">"</span><span class="s">defaultUser"</span>
  <span class="na">password</span><span class="pi">:</span> <span class="s2">"</span><span class="s">defaultPass"</span>
<span class="na">monitors</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">hostname</span><span class="pi">:</span> <span class="s">db1</span>
  <span class="c1"># ...</span>
  <span class="pi">-</span> <span class="na">hostname</span><span class="pi">:</span> <span class="s">db10</span>
</code></pre></div></div> <p>The default <code class="language-plaintext highlighter-rouge">username</code> and <code class="language-plaintext highlighter-rouge">password</code> are applied to the 10 monitors because none of them explicitly set these variables. If a monitor explicitly sets one of the variables, then its explicit value is used instead of the default value.</p> <p class="note">Monitor defaults are convenient, but explicit monitor configuraiton is more clear, so use monitor defatuls sparingly. The intended use case is for variables that <em>must</em> be consistent for all monitors. For example, if Blip monitors Amazon RDS instances in region <code class="language-plaintext highlighter-rouge">us-east-1</code>, then setting monitor default <code class="language-plaintext highlighter-rouge">aws.region: "us-east-1"</code> makes sense.</p> <h2 class="config-section-title" id="aws-1"> <a href="#aws-1" class="anchor-heading" aria-labelledby="aws-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> aws </h2> <p>The <code class="language-plaintext highlighter-rouge">aws</code> section configures Amazon RDS for MySQL.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">aws</span><span class="pi">:</span>
  <span class="na">disable-auto-region</span><span class="pi">:</span> <span class="no">false</span>
  <span class="na">disable-auto-tls</span><span class="pi">:</span> <span class="no">false</span>
  <span class="na">iam-auth-token</span><span class="pi">:</span> <span class="no">false</span>
  <span class="na">password-secret</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
  <span class="na">region</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
</code></pre></div></div> <h3 id="disable-auto-region"> <a href="#disable-auto-region" class="anchor-heading" aria-labelledby="disable-auto-region"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">disable-auto-region</code> </h3> <div class="table-wrapper"><table class="var-table"> <tbody> <tr> <td><strong>Type</strong></td> <td>string</td> </tr> <tr> <td><strong>Valid values</strong></td> <td><code class="language-plaintext highlighter-rouge">true</code> or <code class="language-plaintext highlighter-rouge">false</code></td> </tr> <tr> <td><strong>Default value</strong></td> <td><code class="language-plaintext highlighter-rouge">false</code></td> </tr> </tbody> </table></div> <p>The <code class="language-plaintext highlighter-rouge">disable-auto-region</code> variable enables/disables automatic detection of the AWS region.</p> <h3 id="disable-auto-tls"> <a href="#disable-auto-tls" class="anchor-heading" aria-labelledby="disable-auto-tls"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">disable-auto-tls</code> </h3> <div class="table-wrapper"><table class="var-table"> <tbody> <tr> <td><strong>Type</strong></td> <td>string</td> </tr> <tr> <td><strong>Valid values</strong></td> <td><code class="language-plaintext highlighter-rouge">true</code> or <code class="language-plaintext highlighter-rouge">false</code></td> </tr> <tr> <td><strong>Default value</strong></td> <td><code class="language-plaintext highlighter-rouge">false</code></td> </tr> </tbody> </table></div> <p>The <code class="language-plaintext highlighter-rouge">disable-auto-tls</code> variables enables/disables automatic use of the Amazon RDS certifcate authority (CA). By default, Blip uses the 2019 AWS RDS CA, which is built-in (you don’t need to configure anything). See <a href="../cloud/aws">AWS</a> for details.</p> <h3 id="iam-auth-token"> <a href="#iam-auth-token" class="anchor-heading" aria-labelledby="iam-auth-token"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">iam-auth-token</code> </h3> <div class="table-wrapper"><table class="var-table"> <tbody> <tr> <td><strong>Type</strong></td> <td>bool</td> </tr> <tr> <td><strong>Valid values</strong></td> <td><code class="language-plaintext highlighter-rouge">true</code> or <code class="language-plaintext highlighter-rouge">false</code></td> </tr> <tr> <td><strong>Default value</strong></td> <td><code class="language-plaintext highlighter-rouge">false</code></td> </tr> </tbody> </table></div> <p>The <code class="language-plaintext highlighter-rouge">iam-auth-token</code> variable enables <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/UsingWithRDS.IAMDBAuth">IAM database authentication</a>.</p> <p>When enabled, IAM authentication is the prefered authentication method</p> <h3 id="password-secret"> <a href="#password-secret" class="anchor-heading" aria-labelledby="password-secret"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">password-secret</code> </h3> <div class="table-wrapper"><table class="var-table"> <tbody> <tr> <td><strong>Type</strong></td> <td>string</td> </tr> <tr> <td><strong>Valid values</strong></td> <td>AWS Secrets Manager ARN</td> </tr> <tr> <td><strong>Default value</strong></td> <td> </td> </tr> </tbody> </table></div> <p>The <code class="language-plaintext highlighter-rouge">password-secret</code> variables sets the AWS Secrets Manager ARN that contains the MySQL user password.</p> <h3 id="region"> <a href="#region" class="anchor-heading" aria-labelledby="region"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">region</code> </h3> <div class="table-wrapper"><table class="var-table"> <tbody> <tr> <td><strong>Type</strong></td> <td>string</td> </tr> <tr> <td><strong>Valid values</strong></td> <td> </td> </tr> <tr> <td><strong>Default value</strong></td> <td> </td> </tr> </tbody> </table></div> <p>The <code class="language-plaintext highlighter-rouge">region</code> variable sets the AWS region.</p> <h2 class="config-section-title" id="exporter"> <a href="#exporter" class="anchor-heading" aria-labelledby="exporter"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> exporter </h2> <p>The <code class="language-plaintext highlighter-rouge">exporter</code> section configure Blip to emulate Prometheus <code class="language-plaintext highlighter-rouge">mysqld_exporter</code>.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">exporter</span><span class="pi">:</span>
  <span class="na">flags</span><span class="pi">:</span>
    <span class="s">web.listen-address</span><span class="pi">:</span> <span class="s2">"</span><span class="s">127.0.0.1:9104"</span>
    <span class="s">web.telemetry-path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/metrics"</span>
  <span class="na">mode</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
</code></pre></div></div> <h3 id="flags"> <a href="#flags" class="anchor-heading" aria-labelledby="flags"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">flags</code> </h3> <div class="table-wrapper"><table class="var-table"> <tbody> <tr> <td><strong>Type</strong></td> <td>key-value map (string: string)</td> </tr> <tr> <td><strong>Valid values</strong></td> <td>(see list below)</td> </tr> <tr> <td><strong>Default value</strong></td> <td>(see list below)</td> </tr> </tbody> </table></div> <p>The <code class="language-plaintext highlighter-rouge">flag</code> variable is a key-value map of strings for certain Prometheus mysqld_exporter flags:</p> <ul> <li><code class="language-plaintext highlighter-rouge">web.listen-address</code> (default: <code class="language-plaintext highlighter-rouge">127.0.0.1:9104</code>)</li> <li><code class="language-plaintext highlighter-rouge">web.telemetry-path</code> (default: <code class="language-plaintext highlighter-rouge">/metrics</code>)</li> </ul> <h3 id="mode"> <a href="#mode" class="anchor-heading" aria-labelledby="mode"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">mode</code> </h3> <div class="table-wrapper"><table class="var-table"> <tbody> <tr> <td><strong>Type</strong></td> <td>string</td> </tr> <tr> <td><strong>Valid values</strong></td> <td><code class="language-plaintext highlighter-rouge">dual</code> or <code class="language-plaintext highlighter-rouge">legacy</code></td> </tr> <tr> <td><strong>Default value</strong></td> <td> </td> </tr> </tbody> </table></div> <p>The <code class="language-plaintext highlighter-rouge">mode</code> variables enables the <a href="../prometheus/">Prometheus emualation feature</a>. When set to <code class="language-plaintext highlighter-rouge">dual</code>, Blip runs normally <em>and</em> emulates Prometheus. When set to <code class="language-plaintext highlighter-rouge">legacy</code>, Blip runs <em>only</em> emulates Prometheus. The feature is disabled by default.</p> <h2 class="config-section-title" id="heartbeat"> <a href="#heartbeat" class="anchor-heading" aria-labelledby="heartbeat"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> heartbeat </h2> <p>The <code class="language-plaintext highlighter-rouge">heartbeat</code> section configures the <a href="../hearbeat/">Blip heartbeat feature</a>.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">heartbeat</span><span class="pi">:</span>
  <span class="na">freq</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
  <span class="na">table</span><span class="pi">:</span> <span class="s">blip.heartbeat</span>
</code></pre></div></div> <h3 id="freq-1"> <a href="#freq-1" class="anchor-heading" aria-labelledby="freq-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">freq</code> </h3> <div class="table-wrapper"><table class="var-table"> <tbody> <tr> <td><strong>Type</strong></td> <td>string</td> </tr> <tr> <td><strong>Valid values</strong></td> <td><a href="https://pkg.go.dev/time#ParseDuration">Go duration string</a></td> </tr> <tr> <td><strong>Default value</strong></td> <td> </td> </tr> </tbody> </table></div> <p>The <code class="language-plaintext highlighter-rouge">freq</code> variables sets how frequently heartbeats are written. See <a href="../hearbeat/">Hearbeat</a> for details.</p> <h3 id="table"> <a href="#table" class="anchor-heading" aria-labelledby="table"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">table</code> </h3> <div class="table-wrapper"><table class="var-table"> <tbody> <tr> <td><strong>Type</strong></td> <td>string</td> </tr> <tr> <td><strong>Valid values</strong></td> <td>valid MySQL table name</td> </tr> <tr> <td><strong>Default value</strong></td> <td> </td> </tr> </tbody> </table></div> <p>The <code class="language-plaintext highlighter-rouge">table</code> variables sets the Blip heartbeat table. The default database is <code class="language-plaintext highlighter-rouge">blip</code> if the table name is not database-qualified like <code class="language-plaintext highlighter-rouge">db.heartbeat</code>.</p> <h2 class="config-section-title" id="mysql"> <a href="#mysql" class="anchor-heading" aria-labelledby="mysql"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> mysql </h2> <p>The <code class="language-plaintext highlighter-rouge">mysql</code> section configures how to connect to MySQL.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">mysql</span><span class="pi">:</span>
  <span class="na">hostname</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
  <span class="na">mycnf</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
  <span class="na">password</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
  <span class="na">password-file</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
  <span class="na">socket</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
  <span class="na">timeout-connect</span><span class="pi">:</span> <span class="s2">"</span><span class="s">5s"</span>
  <span class="na">username</span><span class="pi">:</span> <span class="s2">"</span><span class="s">blip"</span>
</code></pre></div></div> <p>This is the most important and common seciton since it configures how Blip connects to MySQL. It’s also the only section that becomes top-level in each <a href="#monitors">monitor config</a>: in a monitor config, omit <code class="language-plaintext highlighter-rouge">mysql:</code> and configure these variables at the top level.</p> <h3 id="hostname"> <a href="#hostname" class="anchor-heading" aria-labelledby="hostname"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">hostname</code> </h3> <div class="table-wrapper"><table class="var-table"> <tbody> <tr> <td><strong>Type</strong></td> <td>string</td> </tr> <tr> <td><strong>Valid values</strong></td> <td><code class="language-plaintext highlighter-rouge">hostname</code> or <code class="language-plaintext highlighter-rouge">hostname:port</code></td> </tr> <tr> <td><strong>Default value</strong></td> <td> </td> </tr> </tbody> </table></div> <p>The <code class="language-plaintext highlighter-rouge">hostname</code> variable sets the MySQL hostname.</p> <h3 id="mycnf"> <a href="#mycnf" class="anchor-heading" aria-labelledby="mycnf"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">mycnf</code> </h3> <div class="table-wrapper"><table class="var-table"> <tbody> <tr> <td><strong>Type</strong></td> <td>string</td> </tr> <tr> <td><strong>Valid values</strong></td> <td>my.cnf file name</td> </tr> <tr> <td><strong>Default value</strong></td> <td> </td> </tr> </tbody> </table></div> <p>The <code class="language-plaintext highlighter-rouge">mycnf</code> variable sets a my.cnf file to read.</p> <p>Blip reads the <code class="language-plaintext highlighter-rouge">[client]</code> section of the my.cnf file:</p> <div class="table-wrapper"><table> <thead> <tr> <th>my.cnf File</th> <th>Blip Variable</th> </tr> </thead> <tbody> <tr> <td>host</td> <td><a href="#hostname"><code class="language-plaintext highlighter-rouge">hostname</code></a></td> </tr> <tr> <td>password</td> <td><a href="#password"><code class="language-plaintext highlighter-rouge">password</code></a></td> </tr> <tr> <td>port</td> <td>Appended to <a href="#hostname"><code class="language-plaintext highlighter-rouge">hostname</code></a></td> </tr> <tr> <td>socket</td> <td><a href="#socket"><code class="language-plaintext highlighter-rouge">socket</code></a></td> </tr> <tr> <td>ssl-ca</td> <td><a href="#ca"><code class="language-plaintext highlighter-rouge">tls.ca</code></a></td> </tr> <tr> <td>ssl-cert</td> <td><a href="#cert"><code class="language-plaintext highlighter-rouge">tls.cert</code></a></td> </tr> <tr> <td>ssl-key</td> <td><a href="#key"><code class="language-plaintext highlighter-rouge">tls.key</code></a></td> </tr> <tr> <td>user</td> <td><a href="#username"><code class="language-plaintext highlighter-rouge">username</code></a></td> </tr> </tbody> </table></div> <h3 id="username"> <a href="#username" class="anchor-heading" aria-labelledby="username"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">username</code> </h3> <div class="table-wrapper"><table class="var-table"> <tbody> <tr> <td><strong>Type</strong></td> <td>string</td> </tr> <tr> <td><strong>Valid values</strong></td> <td> </td> </tr> <tr> <td><strong>Default value</strong></td> <td> </td> </tr> </tbody> </table></div> <p>The <code class="language-plaintext highlighter-rouge">username</code> variable sets the MySQL username.</p> <h3 id="password"> <a href="#password" class="anchor-heading" aria-labelledby="password"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">password</code> </h3> <div class="table-wrapper"><table class="var-table"> <tbody> <tr> <td><strong>Type</strong></td> <td>string</td> </tr> <tr> <td><strong>Valid values</strong></td> <td> </td> </tr> <tr> <td><strong>Default value</strong></td> <td> </td> </tr> </tbody> </table></div> <p>The <code class="language-plaintext highlighter-rouge">password</code> variable sets the MySQL password.</p> <h3 id="password-file"> <a href="#password-file" class="anchor-heading" aria-labelledby="password-file"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">password-file</code> </h3> <div class="table-wrapper"><table class="var-table"> <tbody> <tr> <td><strong>Type</strong></td> <td>string</td> </tr> <tr> <td><strong>Valid values</strong></td> <td> </td> </tr> <tr> <td><strong>Default value</strong></td> <td> </td> </tr> </tbody> </table></div> <p>The <code class="language-plaintext highlighter-rouge">password-file</code> variable sets a file from which Blip reads the MySQL password.</p> <h3 id="socket"> <a href="#socket" class="anchor-heading" aria-labelledby="socket"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">socket</code> </h3> <div class="table-wrapper"><table class="var-table"> <tbody> <tr> <td><strong>Type</strong></td> <td>string</td> </tr> <tr> <td><strong>Valid values</strong></td> <td> </td> </tr> <tr> <td><strong>Default value</strong></td> <td> </td> </tr> </tbody> </table></div> <p>The <code class="language-plaintext highlighter-rouge">socket</code> variable sets the MySQL socket.</p> <h3 id="timeout-connect"> <a href="#timeout-connect" class="anchor-heading" aria-labelledby="timeout-connect"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">timeout-connect</code> </h3> <div class="table-wrapper"><table class="var-table"> <tbody> <tr> <td><strong>Type</strong></td> <td>string</td> </tr> <tr> <td><strong>Valid values</strong></td> <td><a href="https://pkg.go.dev/time#ParseDuration">Go duration string</a></td> </tr> <tr> <td><strong>Default value</strong></td> <td> </td> </tr> </tbody> </table></div> <p>The <code class="language-plaintext highlighter-rouge">timeout-connect</code> variable sets the connection timeout.</p> <h2 class="config-section-title" id="plans"> <a href="#plans" class="anchor-heading" aria-labelledby="plans"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> plans </h2> <p>The <code class="language-plaintext highlighter-rouge">plans</code> section configures the source of <a href="../plans/">plans</a>.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">plans</span><span class="pi">:</span>
  <span class="na">files</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">plan.yaml"</span><span class="pi">]</span>
  <span class="na">table</span><span class="pi">:</span> <span class="s2">"</span><span class="s">blip.plans"</span>
  <span class="na">monitor</span><span class="pi">:</span> <span class="pi">{}</span>
  <span class="na">adjust</span><span class="pi">:</span>
    <span class="c1"># See below</span>
</code></pre></div></div> <h3 id="adjust"> <a href="#adjust" class="anchor-heading" aria-labelledby="adjust"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> adjust </h3> <p>The <code class="language-plaintext highlighter-rouge">adjust</code> subection of the <code class="language-plaintext highlighter-rouge">plan</code> section configures the <a href="../monitor/level-adjuster.hmtml">Level Plan Adjuster (LPA) feature</a>.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">plans</span><span class="pi">:</span>
  <span class="na">adjust</span><span class="pi">:</span>
    <span class="na">offline</span><span class="pi">:</span>
      <span class="na">after</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">plan</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
    <span class="na">standby</span><span class="pi">:</span>
      <span class="na">after</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">plan</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
    <span class="na">read-only</span><span class="pi">:</span>
      <span class="na">after</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">plan</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
    <span class="na">active</span><span class="pi">:</span>
      <span class="na">after</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">plan</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
</code></pre></div></div> <p>Each of the four sections (corresponding to the four <a href="../monitor/level-adjuster#connection-states">connection states</a>) have the same two variables:</p> <h4 id="after"> <a href="#after" class="anchor-heading" aria-labelledby="after"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">after</code> </h4> <div class="table-wrapper"><table class="var-table"> <tbody> <tr> <td><strong>Type</strong></td> <td>string</td> </tr> <tr> <td><strong>Valid values</strong></td> <td><a href="https://pkg.go.dev/time#ParseDuration">Go duration string</a></td> </tr> <tr> <td><strong>Default value</strong></td> <td> </td> </tr> </tbody> </table></div> <p>The <code class="language-plaintext highlighter-rouge">after</code> variable sets how long before the state takes effect.</p> <h4 id="plan"> <a href="#plan" class="anchor-heading" aria-labelledby="plan"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">plan</code> </h4> <div class="table-wrapper"><table class="var-table"> <tbody> <tr> <td><strong>Type</strong></td> <td>string</td> </tr> <tr> <td><strong>Valid values</strong></td> <td>plan name</td> </tr> <tr> <td><strong>Default value</strong></td> <td> </td> </tr> </tbody> </table></div> <p>The <code class="language-plaintext highlighter-rouge">plan</code> variable sets the plan to load when the state takes effect.</p> <h3 id="files-1"> <a href="#files-1" class="anchor-heading" aria-labelledby="files-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">files</code> </h3> <div class="table-wrapper"><table class="var-table"> <tbody> <tr> <td><strong>Type</strong></td> <td>list of strings</td> </tr> <tr> <td><strong>Valid values</strong></td> <td>file names</td> </tr> <tr> <td><strong>Default value</strong></td> <td><code class="language-plaintext highlighter-rouge">plans.yaml</code></td> </tr> </tbody> </table></div> <p>The <code class="language-plaintext highlighter-rouge">files</code> variable is a list of file names from which to load plans. Blip attempts to load the default, <code class="language-plaintext highlighter-rouge">plans.yaml</code>, but it is not required and does not cause an error if the file does not exist. Instead, in this case, Blip uses a default built-in plan. If plan files are explicitly configured, Blip only reads those plan files.</p> <h3 id="monitor"> <a href="#monitor" class="anchor-heading" aria-labelledby="monitor"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">monitor</code> </h3> <div class="table-wrapper"><table class="var-table"> <tbody> <tr> <td><strong>Type</strong></td> <td>dictonary</td> </tr> <tr> <td><strong>Valid values</strong></td> <td><a href="#monitors">Monitor</a></td> </tr> <tr> <td><strong>Default value</strong></td> <td> </td> </tr> </tbody> </table></div> <p>The <code class="language-plaintext highlighter-rouge">monitor</code> variable configures the MySQL instance from which the <a href="#table-1"><code class="language-plaintext highlighter-rouge">table</code></a> is loaded.</p> <h3 id="table-1"> <a href="#table-1" class="anchor-heading" aria-labelledby="table-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">table</code> </h3> <div class="table-wrapper"><table class="var-table"> <tbody> <tr> <td><strong>Type</strong></td> <td>string</td> </tr> <tr> <td><strong>Valid values</strong></td> <td>valid MySQL table name</td> </tr> <tr> <td><strong>Default value</strong></td> <td> </td> </tr> </tbody> </table></div> <p>The <code class="language-plaintext highlighter-rouge">table</code> variable configures the MySQL table name from which plans are loaded.</p> <h2 class="config-section-title" id="sinks"> <a href="#sinks" class="anchor-heading" aria-labelledby="sinks"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> sinks </h2> <p>The <code class="language-plaintext highlighter-rouge">sinks</code> section configures <a href="../metrics/sinks#built-in">built-in metrics sinks</a> and <a href="../metrics/sinks#custom">custom metrics sinks</a>. This section is a map of maps:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">sinks</span><span class="pi">:</span>
  <span class="na">sinkName1</span><span class="pi">:</span>
    <span class="na">option1</span><span class="pi">:</span> <span class="s">value1</span>
  <span class="na">sinkName2</span><span class="pi">:</span>
    <span class="na">option1</span><span class="pi">:</span> <span class="s">value1</span>
</code></pre></div></div> <p>Blip has three built-in sinks named <code class="language-plaintext highlighter-rouge">log</code>, <code class="language-plaintext highlighter-rouge">singalfx</code>, and <code class="language-plaintext highlighter-rouge">chronosphere</code>. The options for each are listed below.</p> <h3 id="chronosphere"> <a href="#chronosphere" class="anchor-heading" aria-labelledby="chronosphere"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> chronosphere </h3> <div class="table-wrapper"><table> <thead> <tr> <th>Key</th> <th>Value</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code class="language-plaintext highlighter-rouge">url</code></td> <td>Remote write URL</td> <td><code class="language-plaintext highlighter-rouge">http://127.0.0.1:3030/openmetrics/write</code></td> </tr> </tbody> </table></div> <h3 id="log"> <a href="#log" class="anchor-heading" aria-labelledby="log"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> log </h3> <p>The Blip built-in <code class="language-plaintext highlighter-rouge">log</code> sink has no options.</p> <h3 id="noop"> <a href="#noop" class="anchor-heading" aria-labelledby="noop"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> noop </h3> <p>The Blip built-in <code class="language-plaintext highlighter-rouge">noop</code> sink has no options. It discards all metrics, which is useful for testing end-to-end metrics collection without having to send the metrics somewhere.</p> <h3 id="signalfix"> <a href="#signalfix" class="anchor-heading" aria-labelledby="signalfix"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> signalfix </h3> <div class="table-wrapper"><table> <thead> <tr> <th>Key</th> <th>Value</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code class="language-plaintext highlighter-rouge">auth-token</code></td> <td>API authentication token</td> <td> </td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">auth-token-file</code></td> <td>File to read API auth token from</td> <td> </td> </tr> </tbody> </table></div> <h2 class="config-section-title" id="tags"> <a href="#tags" class="anchor-heading" aria-labelledby="tags"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> tags </h2> <p>The <code class="language-plaintext highlighter-rouge">tags</code> section sets user-defined key-value pairs (as strings) that are passed to each sink. For example (using <a href="#interpolation">interpolation</a>):</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">tags</span><span class="pi">:</span>
  <span class="na">env</span><span class="pi">:</span> <span class="s">${ENVIRONMENT:-dev}</span>
  <span class="na">dc</span><span class="pi">:</span> <span class="s">${DATACENTER:-local}</span>
  <span class="na">hostname</span><span class="pi">:</span> <span class="err">%</span><span class="pi">{</span><span class="nv">monitor.hostname</span><span class="pi">}</span>
</code></pre></div></div> <p>Blip calls these “tags”, but each sink might have a different term for the same concept. For example, with SignalFx these are called “dimensions”. But the concept is the same: metadata (usually string key-value pairs) attached to metrics that describe or annotate the metrics for grouping, aggregation, or filtering when display in graphs/charts.</p> <p>The <a href="../metrics/sinks#built-in">built-in metrics sinks</a> automatically send all tags with metrics. For example, the <code class="language-plaintext highlighter-rouge">signalfx</code> sink sends the tags as SingalFx dimensions.</p> <h2 class="config-section-title" id="tls"> <a href="#tls" class="anchor-heading" aria-labelledby="tls"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> tls </h2> <p>The <code class="language-plaintext highlighter-rouge">tls</code> section configures TLS certificates.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">tls</span><span class="pi">:</span>
  <span class="na">ca</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
  <span class="na">cert</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
  <span class="na">key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
</code></pre></div></div> <p>You can specify only <code class="language-plaintext highlighter-rouge">tls.ca</code>, or <code class="language-plaintext highlighter-rouge">tls.cert</code> and <code class="language-plaintext highlighter-rouge">tls.key</code>, or all three; any other combination is invalid.</p> <p class="note">By default, Blip does not use TLS for MySQL connections <em>except</em> when using AWS; see section <a href="#aws"><code class="language-plaintext highlighter-rouge">aws</code></a> or <a href="../cloud/aws">AWS</a>.</p> <h3 id="ca"> <a href="#ca" class="anchor-heading" aria-labelledby="ca"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">ca</code> </h3> <div class="table-wrapper"><table class="var-table"> <tbody> <tr> <td><strong>Type</strong></td> <td>string</td> </tr> <tr> <td><strong>Valid values</strong></td> <td>file name</td> </tr> <tr> <td><strong>Default value</strong></td> <td> </td> </tr> </tbody> </table></div> <p>The <code class="language-plaintext highlighter-rouge">ca</code> variables sets the certificate authority file.</p> <h3 id="cert"> <a href="#cert" class="anchor-heading" aria-labelledby="cert"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">cert</code> </h3> <div class="table-wrapper"><table class="var-table"> <tbody> <tr> <td><strong>Type</strong></td> <td>string</td> </tr> <tr> <td><strong>Valid values</strong></td> <td>file name</td> </tr> <tr> <td><strong>Default value</strong></td> <td> </td> </tr> </tbody> </table></div> <p>The <code class="language-plaintext highlighter-rouge">cert</code> variables sets the public certificate file.</p> <h3 id="key"> <a href="#key" class="anchor-heading" aria-labelledby="key"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">key</code> </h3> <div class="table-wrapper"><table class="var-table"> <tbody> <tr> <td><strong>Type</strong></td> <td>string</td> </tr> <tr> <td><strong>Valid values</strong></td> <td>file name</td> </tr> <tr> <td><strong>Default value</strong></td> <td> </td> </tr> </tbody> </table></div> <p>The <code class="language-plaintext highlighter-rouge">key</code> variables sets the private key file.</p> <h1 id="monitors"> <a href="#monitors" class="anchor-heading" aria-labelledby="monitors"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Monitors </h1> <p>The <code class="language-plaintext highlighter-rouge">monitors</code> section is a list of MySQL instances to monitor. Each instance is a YAML dictionary containing any of the <a href="#monitor-defaults">monitor default sections</a> with one exception: <code class="language-plaintext highlighter-rouge">mysql</code> variables are top-level in a monitor. The example below shows two different MySQL instances to monitor.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">monitors</span><span class="pi">:</span>

  <span class="pi">-</span> <span class="na">hostname</span><span class="pi">:</span> <span class="s">db1.local</span>
    <span class="na">username</span><span class="pi">:</span> <span class="s">metrics</span>
    <span class="na">password-file</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/secret/db-password"</span>
    <span class="na">heartbeat</span><span class="pi">:</span>
      <span class="na">freq</span><span class="pi">:</span> <span class="s">1s</span>

  <span class="pi">-</span> <span class="na">mycnf</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/secret/my.cnf"</span>
    <span class="na">exporter</span><span class="pi">:</span>
      <span class="na">mode</span><span class="pi">:</span> <span class="s">legacy</span>
</code></pre></div></div> <p>The first MySQL instance is configured in lines 3-7. (Note the single, leading hyphen on line 3 that denotes an item in a YAML list.) The first three variables—<code class="language-plaintext highlighter-rouge">hostname</code>, <code class="language-plaintext highlighter-rouge">username</code>, and <code class="language-plaintext highlighter-rouge">password-file</code>—are <a href="#mysql"><code class="language-plaintext highlighter-rouge">mysql</code></a> variables but in a monitor they are top-level. But all other sections, like <a href="#heartbeat"><code class="language-plaintext highlighter-rouge">heartbeat</code></a> and its variable <code class="language-plaintext highlighter-rouge">freq</code>, are exactly the same in a monitor.</p> <p>The second MySQL instance is configured in lines 9-11. Variable <code class="language-plaintext highlighter-rouge">mycnf</code> belongs to section <code class="language-plaintext highlighter-rouge">mysql</code>, but again: in a monitor, <a href="#mysql"><code class="language-plaintext highlighter-rouge">mysql</code></a> variables are top-level. Section <a href="#exporter"><code class="language-plaintext highlighter-rouge">exporter</code></a> is exactly the same in a monitor.</p> <p><b>Refer to <a href="#monitor-defaults">Monitor Defaults</a> for configuring MySQL instances, and remember: <a href="#mysql"><code class="language-plaintext highlighter-rouge">mysql</code></a> variables are top-level in a monitor (omit <code class="language-plaintext highlighter-rouge">mysql:</code> and include the variables directly).<b></b></b></p> <p>Monitors have two variables that only appear in monitors: <code class="language-plaintext highlighter-rouge">id</code> and <code class="language-plaintext highlighter-rouge">meta</code>.</p> <h3 id="id"> <a href="#id" class="anchor-heading" aria-labelledby="id"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">id</code> </h3> <div class="table-wrapper"><table class="var-table"> <tbody> <tr> <td><strong>Type</strong></td> <td>string</td> </tr> <tr> <td><strong>Valid values</strong></td> <td>any string</td> </tr> <tr> <td><strong>Default value</strong></td> <td>(automatic)</td> </tr> </tbody> </table></div> <p>The <code class="language-plaintext highlighter-rouge">id</code> variable uniquely identifies the MySQL instance in Blip.</p> <p>Every monitor has a unique ID that, by default, Blip sets automatically. You can set monitor IDs manually, but it’s better to let Blip set them automatically to avoid duplicates (which causes a fatal error).</p> <p>Blip uses monitor IDs to track and report each MySQL instance in its own output and API.</p> <p>Blip does <em>not</em> use monitor IDs to identify MySQL instances for reporting metrics, but you can use them if you want. For example:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">monitors</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s">db1</span>
    <span class="na">hostname</span><span class="pi">:</span> <span class="s">db1.local</span>
    <span class="na">tags</span><span class="pi">:</span>
      <span class="na">monitorId</span><span class="pi">:</span> <span class="err">%</span><span class="pi">{</span><span class="nv">monitor.id</span><span class="pi">}</span>
</code></pre></div></div> <p>Since tags are passed to sinks (which report metrics), all sinks will receive the monitor ID. (Sinks receive the monitor ID at the code-level too, so technically this example is not necessary.)</p> <p>Monitor IDs are not garuanteed to be stable—they might change between Blip versions. Therefore, do not rely on them outside of Blip for truly stable, unique MySQL instance identification.</p> <h3 id="meta"> <a href="#meta" class="anchor-heading" aria-labelledby="meta"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">meta</code> </h3> <div class="table-wrapper"><table class="var-table"> <tbody> <tr> <td><strong>Type</strong></td> <td>key-value map (string: string)</td> </tr> <tr> <td><strong>Valid values</strong></td> <td>any strings</td> </tr> <tr> <td><strong>Default value</strong></td> <td> </td> </tr> </tbody> </table></div> <p>The <code class="language-plaintext highlighter-rouge">meta</code> variable is a map of key-value strings extrensic to Blip.</p> <p>“Extrensic to Blip” is a fancy but succinct way of saying that <code class="language-plaintext highlighter-rouge">meta</code> data is not used by Blip, but it can be used by you. For example by contrast, all other variables are used by Blip in some way, for some purpose. But not <code class="language-plaintext highlighter-rouge">meta</code>. However, you can still reference <code class="language-plaintext highlighter-rouge">meta</code> in the config file and <a href="../plans/">plans</a>: <code class="language-plaintext highlighter-rouge">%{monitor.meta.KEY}</code>.</p> <p><code class="language-plaintext highlighter-rouge">meta</code> solves at least one problem: passing the source DSN for a replica from monitor config to plan. Imagine you have two MySQL instances: <code class="language-plaintext highlighter-rouge">source.db</code> and <code class="language-plaintext highlighter-rouge">replica.db</code>, where the latter replicates from the former. Problem is: there is no configuration section to define the source MySQL instance.</p> <p class="note">Configuring replication sources in Blip is not an easy problem to solve because replication topologies change when replicas are used for high availability, and <a href="https://dev.mysql.com/doc/refman/8.0/en/group-replication">MySQL Group Replication</a> has different requirements.</p> <p>To solve this problem, you configure the source DSN in <code class="language-plaintext highlighter-rouge">meta</code>:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">monitors</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">hostname</span><span class="pi">:</span> <span class="s">replica.db</span>
    <span class="na">meta</span><span class="pi">:</span>
      <span class="na">source-host</span><span class="pi">:</span> <span class="s">source.db</span>
      <span class="na">source-user</span><span class="pi">:</span> <span class="s">repl</span>
      <span class="na">source-pass</span><span class="pi">:</span> <span class="s">pleaseDontLag</span>
</code></pre></div></div> <p>You could configure it in <a href="#tags"><code class="language-plaintext highlighter-rouge">tags</code></a>, too, but tags are copied to sinks whereas metadata is not. Therefore, this configuration is better placed in <code class="language-plaintext highlighter-rouge">meta</code> than <code class="language-plaintext highlighter-rouge">tags</code>.</p> <p>Then in the plan, reference the metadata:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">replication</span><span class="pi">:</span>
  <span class="na">freq</span><span class="pi">:</span> <span class="s">5s</span>
  <span class="na">collect</span><span class="pi">:</span>
    <span class="na">repl</span><span class="pi">:</span>
      <span class="na">options</span><span class="pi">:</span>
        <span class="na">source-host</span><span class="pi">:</span> <span class="err">%</span><span class="pi">{</span><span class="nv">monitor.meta.source-host</span><span class="pi">}</span>
        <span class="na">source-user</span><span class="pi">:</span> <span class="err">%</span><span class="pi">{</span><span class="nv">monitor.meta.source-user</span><span class="pi">}</span>
        <span class="na">source-pass</span><span class="pi">:</span> <span class="err">%</span><span class="pi">{</span><span class="nv">monitor.meta.source-pass</span><span class="pi">}</span>
      <span class="na">metrics</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">lag</span>
</code></pre></div></div> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
